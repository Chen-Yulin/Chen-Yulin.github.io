<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta name="theme-color" content="#123456"><title>Tag: Python - Chen Yulin&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#6495ed"><meta name="application-name" content="Icarus - Hexo Theme"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#6495ed"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Icarus - Hexo Theme"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Chen Yulin&#039;s Blog"><meta property="og:url" content="http://chen-yulin.github.io/"><meta property="og:site_name" content="Chen Yulin&#039;s Blog"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://chen-yulin.github.io/img/og_image.png"><meta property="article:author" content="Chen Yulin"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://chen-yulin.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://chen-yulin.github.io"},"headline":"Chen Yulin's Blog","image":["http://chen-yulin.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Chen Yulin"},"publisher":{"@type":"Organization","name":"Chen Yulin's Blog","logo":{"@type":"ImageObject","url":{"light":"/img/cyllogo.png","dark":"/img/cyllogonight.png"}}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><script type="text/javascript" src="/js/imaegoo/night.js"></script><canvas id="universe"></canvas><canvas id="flower"></canvas><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img class="logo-img" src="/img/cyllogo.png" alt="Chen Yulin&#039;s Blog" height="28"><img class="logo-img-dark" src="/img/cyllogonight.png" alt="Chen Yulin&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Chen-Yulin"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags/">Tags</a></li><li class="is-active"><a href="#" aria-current="page">Python</a></li></ul></nav></div></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/12/14/%5BOBS%5Dlinux-Nvidia-Cuda+Torch/"><img class="fill" src="/gallery/Python.png" alt="Cuda+Torch" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-12-13T21:09:12.000Z" title="12/14/2024, 5:09:12 AM">2024-12-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.573Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Note/">Note</a></span><span class="level-item">3 minutes read (About 485 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/14/%5BOBS%5Dlinux-Nvidia-Cuda+Torch/">Cuda+Torch</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><p><code>nvidia-smi</code>返回的是driver所能支持的最新的cuda版本<br>系统安装的cuda版本可以随意，torch会优先使用虚拟环境中安装的cuda版本</p>
<h2 id="Conda管理Cuda"><a href="#Conda管理Cuda" class="headerlink" title="Conda管理Cuda"></a>Conda管理Cuda</h2><p>安装指定版本<code>cuda-toolkit</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install nvidia/label/cuda-12.4.0::cuda-toolkit -c nvidia/label/cuda-12.4.0  </span><br></pre></td></tr></table></figure>
<p>安装最新版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install cuda-toolkit</span><br></pre></td></tr></table></figure>

<p>某些仓库需要指定cuda路径才能编译包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda <span class="built_in">env</span> config vars <span class="built_in">set</span> LD_LIBRARY_PATH=<span class="string">&quot;/home/cyl/miniconda3/envs/gsam/lib/python3.10/site-packages/nvidia/cuda_runtime/lib/:<span class="variable">$LD_LIBRARY_PATH</span>&quot;</span></span><br><span class="line">conda <span class="built_in">env</span> config vars <span class="built_in">set</span> CPATH=<span class="string">&quot;/home/cyl/miniconda3/envs/gsam/lib/python3.10/site-packages/nvidia/cuda_runtime/include/:<span class="variable">$CPATH</span>&quot;</span></span><br><span class="line">conda <span class="built_in">env</span> config vars <span class="built_in">set</span> CUDA_HOME=<span class="string">&quot;/home/cyl/miniconda3/envs/gsam/&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong> 注意改变了库路径之后nvim中的lsp会报错，建议之后改回去</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda <span class="built_in">env</span> config vars <span class="built_in">set</span> LD_LIBRARY_PATH=<span class="string">&quot;&quot;</span></span><br><span class="line">conda <span class="built_in">env</span> config vars <span class="built_in">set</span> CPATH=<span class="string">&quot;&quot;</span></span><br><span class="line">conda <span class="built_in">env</span> config vars <span class="built_in">set</span> CUDA_HOME=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>Note:</strong> To find the correct path for <code>CUDA_HOME</code> use <code>which nvcc</code>. In my case, output of the command was:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; which nvcc </span><br><span class="line">/home/user/miniconda3/envs/py12/bin/nvcc</span><br></pre></td></tr></table></figure>

<p>Therefore, I set the <code>CUDA_HOME</code> as <code>/home/user/miniconda3/envs/py12/</code>.</p>
<p><strong>Note:</strong> To find the correct path for <code>LD_LIBRARY_PATH</code> use <code>find ~ -name cuda_runtime_api.h</code>. In my case, output of the command was:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; find ~ -name cuda_runtime_api.h</span><br><span class="line">...</span><br><span class="line">/home/user/miniconda3/envs/py12/targets/x86_64-linux/include/cuda_runtime_api.h</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>So I set the <code>LD_LIBRARY_PATH</code> as <code>/home/user/miniconda3/envs/py12/targets/x86_64-linux/lib/</code> and <code>CPATH</code> as <code>/home/user/miniconda3/envs/py12/targets/x86_64-linux/include/</code>. If you have multiple CUDA installations, the output of <code>find ~ -name cuda_runtime_api.h</code> will display multiple paths. Make sure to choose the path that corresponds to the environment you have created.</p>
<p>ref:<a target="_blank" rel="noopener" href="https://github.com/IDEA-Research/GroundingDINO/issues/355">https://github.com/IDEA-Research/GroundingDINO/issues/355</a></p>
<p><strong>Note:</strong> Always reboot the computer after the cuda is upgraded</p>
<p>Note: 在更改<code>LD_LIBRARY_PATH</code>后可能会导致neovim的pyright无法运行，所以建议在编译完成后设回该变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda <span class="built_in">env</span> config vars <span class="built_in">set</span> LD_LIBRARY_PATH=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="cudatoolkit和cuda-toolkit"><a href="#cudatoolkit和cuda-toolkit" class="headerlink" title="cudatoolkit和cuda-toolkit"></a><code>cudatoolkit</code>和<code>cuda-toolkit</code></h2><p>这两个可以同时安装<br>如果不安装<code>cudatoolkit</code>可能会在编译时出现<code>ld: cannot find -lcudart: No such file or directory collect2: error: ld returned 1 exit status</code> 报错</p>
<p>使用以下指令获取版本信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import torch;print(torch.__version__);print(torch.version.cuda)&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2.0.0+cu117</span><br><span class="line">11.7</span><br></pre></td></tr></table></figure>

</div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/12/10/%5BOBS%5Dlinux-Use%20SSH%20to%20Connect%20Jupyter-lab/"><img class="fill" src="/gallery/Python.png" alt="Use SSH to Connect Jupyter-lab" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-12-10T14:52:59.000Z" title="12/10/2024, 10:52:59 PM">2024-12-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.576Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Note/">Note</a></span><span class="level-item">a minute read (About 174 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/10/%5BOBS%5Dlinux-Use%20SSH%20to%20Connect%20Jupyter-lab/">Use SSH to Connect Jupyter-lab</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><p>使用ssh作为命令行远程工具，启动远程的jupyter lab并且在本地的浏览器中打开。</p>
<p>远程运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter lab --no-browser --port=8080</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>--no-broswer</code> is very important</p>
</blockquote>
<p>output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">[I 2024-12-10 14:30:24.585 ServerApp]     http://127.0.0.1:8080/lab?token=0061d1eb31396b1bc3cd77a7161b2084da1dedcdeca0600c</span><br><span class="line">[I 2024-12-10 14:30:24.586 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 2024-12-10 14:30:24.603 ServerApp]</span><br><span class="line"></span><br><span class="line">    To access the server, open this file in a browser:</span><br><span class="line">        file:///home/bohanfeng/.local/share/jupyter/runtime/jpserver-11659-open.html</span><br><span class="line">    Or copy and paste one of these URLs:</span><br><span class="line">        http://localhost:8080/lab?token=0061d1eb31396b1bc3cd77a7161b2084da1dedcdeca0600c</span><br><span class="line">        http://127.0.0.1:8080/lab?token=0061d1eb31396b1bc3cd77a7161b2084da1dedcdeca0600c</span><br></pre></td></tr></table></figure>

<p>本地运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 8080:localhost:8080 bohanfeng@192.168.2.102</span><br></pre></td></tr></table></figure>

<p>本地浏览器访问：<br><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/lab?token=0061d1eb31396b1bc3cd77a7161b2084da1dedcdeca0600c">http://127.0.0.1:8080/lab?token=0061d1eb31396b1bc3cd77a7161b2084da1dedcdeca0600c</a></p>
<div class="post-content"><a href="/2024/12/10/[OBS]linux-Use SSH to Connect Jupyter-lab/Pasted_image_20241210145953.png" title="" title=" class="gallery-item"><img src="/2024/12/10/[OBS]linux-Use SSH to Connect Jupyter-lab/Pasted_image_20241210145953.png" alt="" title=""></a></div></div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/12/03/%5BOBS%5DFL-FLamby/"><img class="fill" src="/gallery/Python.png" alt="FLamby" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-12-02T18:14:21.000Z" title="12/3/2024, 2:14:21 AM">2024-12-03</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.537Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Note/">Note</a></span><span class="level-item">4 minutes read (About 609 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/03/%5BOBS%5DFL-FLamby/">FLamby</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><p>Repository: <a target="_blank" rel="noopener" href="https://github.com/owkin/FLamby">https://github.com/owkin/FLamby</a></p>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/owkin/FLamby.git</span><br><span class="line"><span class="built_in">cd</span> FLamby</span><br><span class="line">conda <span class="built_in">env</span> create -f environment.yml</span><br><span class="line">conda activate flamby</span><br><span class="line">pip install -e .[all_extra]</span><br><span class="line">pip install wget</span><br><span class="line">pip install lifelines</span><br><span class="line">pip install jupyterlab</span><br></pre></td></tr></table></figure>

<h2 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h2><p>Fed-TCGA-BCRA<br><a target="_blank" rel="noopener" href="https://owkin.github.io/FLamby/fed_tcga_brca.html">https://owkin.github.io/FLamby/fed_tcga_brca.html</a></p>
<h2 id="Baseline-Learning"><a href="#Baseline-Learning" class="headerlink" title="Baseline Learning"></a>Baseline Learning</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> flamby.utils <span class="keyword">import</span> evaluate_model_on_tests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 lines of code to change to switch to another dataset</span></span><br><span class="line"><span class="keyword">from</span> flamby.datasets.fed_tcga_brca <span class="keyword">import</span> (</span><br><span class="line">    BATCH_SIZE,</span><br><span class="line">    LR,</span><br><span class="line">    NUM_EPOCHS_POOLED,</span><br><span class="line">    Baseline,</span><br><span class="line">    BaselineLoss,</span><br><span class="line">    metric,</span><br><span class="line">    NUM_CLIENTS,</span><br><span class="line">    Optimizer,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> flamby.datasets.fed_tcga_brca <span class="keyword">import</span> FedTcgaBrca <span class="keyword">as</span> FedDataset</span><br></pre></td></tr></table></figure>
<p>Import several macros, datasets and metrics.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Instantiation of local train set (and data loader)), baseline loss function, baseline model, default optimizer</span></span><br><span class="line">train_dataset = FedDataset(center=<span class="number">0</span>, train=<span class="literal">True</span>, pooled=<span class="literal">False</span>)</span><br><span class="line">train_dataloader = torch.utils.data.DataLoader(train_dataset, batch_size=BATCH_SIZE, shuffle=<span class="literal">True</span>, num_workers=<span class="number">0</span>)</span><br><span class="line">lossfunc = BaselineLoss()</span><br><span class="line">model = Baseline()</span><br><span class="line">optimizer = Optimizer(model.parameters(), lr=LR)</span><br></pre></td></tr></table></figure>
<p>In this script, the <code>pooled</code> parameter is set to <code>False</code> when creating the <code>FedDataset</code> instances. This indicates that the dataset is not pooled, meaning that the data is kept separate for each client or center. Each client or center has its own local dataset, which is a common setup in federated learning to simulate real-world scenarios where data is distributed across different locations or devices.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Traditional pytorch training loop</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, NUM_EPOCHS_POOLED):</span><br><span class="line">    <span class="keyword">for</span> idx, (X, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_dataloader):</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        outputs = model(X)</span><br><span class="line">        loss = lossfunc(outputs, y)</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br></pre></td></tr></table></figure>
<p>正常的训练流程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Evaluation</span></span><br><span class="line"><span class="comment"># Instantiation of a list of the local test sets</span></span><br><span class="line">test_dataloaders = [</span><br><span class="line">            torch.utils.data.DataLoader(</span><br><span class="line">                FedDataset(center=i, train=<span class="literal">False</span>, pooled=<span class="literal">False</span>),</span><br><span class="line">                batch_size=BATCH_SIZE,</span><br><span class="line">                shuffle=<span class="literal">False</span>,</span><br><span class="line">                num_workers=<span class="number">0</span>,</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(NUM_CLIENTS)</span><br><span class="line">        ]</span><br><span class="line"><span class="comment"># Function performing the evaluation</span></span><br><span class="line">dict_cindex = evaluate_model_on_tests(model, test_dataloaders, metric)</span><br><span class="line"><span class="built_in">print</span>(dict_cindex)</span><br></pre></td></tr></table></figure>
<p>使用的evaluation metric是<code>lifelines.utils.concordance_index</code>，返回的是c_index</p>
<div class="post-content"><a href="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241205160805.png" title="" title=" class="gallery-item"><img src="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241205160805.png" alt="" title=""></a></div>

<h2 id="Federated-Learning"><a href="#Federated-Learning" class="headerlink" title="Federated Learning"></a>Federated Learning</h2><div class="post-content"><a href="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241205175215.png" title="" title=" class="gallery-item"><img src="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241205175215.png" alt="" title=""></a></div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> flamby.utils <span class="keyword">import</span> evaluate_model_on_tests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 lines of code to change to switch to another dataset</span></span><br><span class="line"><span class="keyword">from</span> flamby.datasets.fed_tcga_brca <span class="keyword">import</span> (</span><br><span class="line">    BATCH_SIZE,</span><br><span class="line">    LR,</span><br><span class="line">    NUM_EPOCHS_POOLED,</span><br><span class="line">    Baseline,</span><br><span class="line">    BaselineLoss,</span><br><span class="line">    metric,</span><br><span class="line">    NUM_CLIENTS,</span><br><span class="line">    get_nb_max_rounds</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> flamby.datasets.fed_tcga_brca <span class="keyword">import</span> FedTcgaBrca <span class="keyword">as</span> FedDataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1st line of code to change to switch to another strategy</span></span><br><span class="line"><span class="keyword">from</span> flamby.strategies.fed_avg <span class="keyword">import</span> FedAvg <span class="keyword">as</span> strat</span><br></pre></td></tr></table></figure>
use `FedAvg` as strategy

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We loop on all the clients of the distributed dataset and instantiate associated data loaders</span></span><br><span class="line">train_dataloaders = [</span><br><span class="line">            torch.utils.data.DataLoader(</span><br><span class="line">                FedDataset(center = i, train = <span class="literal">True</span>, pooled = <span class="literal">False</span>),</span><br><span class="line">                batch_size = BATCH_SIZE,</span><br><span class="line">                shuffle = <span class="literal">True</span>,</span><br><span class="line">                num_workers = <span class="number">0</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(NUM_CLIENTS)</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">lossfunc = BaselineLoss()</span><br><span class="line">m = Baseline()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Federated Learning loop</span></span><br><span class="line"><span class="comment"># 2nd line of code to change to switch to another strategy (feed the FL strategy the right HPs)</span></span><br><span class="line">args = &#123;</span><br><span class="line">            <span class="string">&quot;training_dataloaders&quot;</span>: train_dataloaders,</span><br><span class="line">            <span class="string">&quot;model&quot;</span>: m,</span><br><span class="line">            <span class="string">&quot;loss&quot;</span>: lossfunc,</span><br><span class="line">            <span class="string">&quot;optimizer_class&quot;</span>: torch.optim.SGD,</span><br><span class="line">            <span class="string">&quot;learning_rate&quot;</span>: LR / <span class="number">10.0</span>,</span><br><span class="line">            <span class="string">&quot;num_updates&quot;</span>: <span class="number">100</span>,</span><br><span class="line"><span class="comment"># This helper function returns the number of rounds necessary to perform approximately as many</span></span><br><span class="line"><span class="comment"># epochs on each local dataset as with the pooled training</span></span><br><span class="line">            <span class="string">&quot;nrounds&quot;</span>: get_nb_max_rounds(<span class="number">100</span>),</span><br><span class="line">        &#125;</span><br><span class="line">s = strat(**args)</span><br><span class="line">m = s.run()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Evaluation</span></span><br><span class="line"><span class="comment"># We only instantiate one test set in this particular case: the pooled one</span></span><br><span class="line">test_dataloaders = [</span><br><span class="line">            torch.utils.data.DataLoader(</span><br><span class="line">                FedDataset(train = <span class="literal">False</span>, pooled = <span class="literal">True</span>),</span><br><span class="line">                batch_size = BATCH_SIZE,</span><br><span class="line">                shuffle = <span class="literal">False</span>,</span><br><span class="line">                num_workers = <span class="number">0</span>,</span><br><span class="line">            )</span><br><span class="line">        ]</span><br><span class="line">dict_cindex = evaluate_model_on_tests(m, test_dataloaders, metric)</span><br><span class="line"><span class="built_in">print</span>(dict_cindex)</span><br></pre></td></tr></table></figure>

<h2 id="FedAvg-vs-FedAvgFineTuning"><a href="#FedAvg-vs-FedAvgFineTuning" class="headerlink" title="FedAvg vs FedAvgFineTuning"></a>FedAvg vs FedAvgFineTuning</h2><h3 id="FedAvg"><a href="#FedAvg" class="headerlink" title="FedAvg"></a>FedAvg</h3><div class="post-content"><a href="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241204174018.png" title="" title=" class="gallery-item"><img src="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241204174018.png" alt="" title=""></a></div>

<h3 id="FedAvgFineTuning"><a href="#FedAvgFineTuning" class="headerlink" title="FedAvgFineTuning"></a>FedAvgFineTuning</h3><div class="post-content"><a href="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241206140537.png" title="" title=" class="gallery-item"><img src="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241206140537.png" alt="" title=""></a></div>
<div class="post-content"><a href="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241204174000.png" title="" title=" class="gallery-item"><img src="/2024/12/03/[OBS]FL-FLamby/Pasted_image_20241204174000.png" alt="" title=""></a></div>

</div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/11/17/%5BOBS%5DPoseEstimation-Cosypose%20(multi-view)%20Adaption/"><img class="fill" src="/gallery/Python.png" alt="Cosypose modification" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-11-16T16:35:56.000Z" title="11/17/2024, 12:35:56 AM">2024-11-17</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.539Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Note/">Note</a></span><span class="level-item">18 minutes read (About 2722 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/11/17/%5BOBS%5DPoseEstimation-Cosypose%20(multi-view)%20Adaption/">Cosypose modification</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><p>仓库: <a target="_blank" rel="noopener" href="https://github.com/Simple-Robotics/cosypose">https://github.com/Simple-Robotics/cosypose</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --recurse-submodules https://github.com/Simple-Robotics/cosypose.git</span><br><span class="line"><span class="built_in">cd</span> cosypose</span><br><span class="line">conda <span class="built_in">env</span> create -n cosypose --file environment.yaml</span><br></pre></td></tr></table></figure>

<p>注意执行这一步的时候pip 会提示setuptools 和matplotlib-inline不符合3.7.6的python，到环境中手动安装适配的版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda activate cosypose</span><br><span class="line">pip install setuptools==63.4.1</span><br><span class="line">pip install matplotlib-inline==0.1.6</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git lfs pull</span><br><span class="line">python setup.py install</span><br><span class="line">python setup.py develop</span><br></pre></td></tr></table></figure>

<p>根据README下载数据<br>注意第一块指令无法下载成功，由 <a target="_blank" rel="noopener" href="https://bop.felk.cvut.cz/datasets/">https://bop.felk.cvut.cz/datasets/</a> 得知下载链接迁移到了huggingface, <a target="_blank" rel="noopener" href="https://huggingface.co/datasets/bop-benchmark/datasets/tree/main/ycbv">https://huggingface.co/datasets/bop-benchmark/datasets/tree/main/ycbv</a> 可以从这里手动下载测试集并放置到<code>local_data/bop_datasets/ycbv/test</code></p>
<p>设置测试使用的models</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> ./local_data/bop_datasets/ycbv/model_bop_compat_eval ./local_data/bop_datasets/ycbv/models</span><br></pre></td></tr></table></figure>

<h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><h3 id="np-where-mask-0-item"><a href="#np-where-mask-0-item" class="headerlink" title="np.where(mask)[0].item()"></a><code>np.where(mask)[0].item()</code></h3><p>运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CUDA_VISIBLE_DEVICES=0 </span><br><span class="line">python -m cosypose.scripts.run_cosypose_eval --config ycbv</span><br></pre></td></tr></table></figure>
<p>时出现报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/home/cyl/.conda/envs/cosypose/lib/python3.7/runpy.py&quot;</span>, line 193, <span class="keyword">in</span> _run_module_as_main</span><br><span class="line">    <span class="string">&quot;__main__&quot;</span>, mod_spec)</span><br><span class="line">  File <span class="string">&quot;/home/cyl/.conda/envs/cosypose/lib/python3.7/runpy.py&quot;</span>, line 85, <span class="keyword">in</span> _run_code</span><br><span class="line">    <span class="built_in">exec</span>(code, run_globals)</span><br><span class="line">  File <span class="string">&quot;/home/cyl/cosypose/cosypose/scripts/run_cosypose_eval.py&quot;</span>, line 491, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    main()</span><br><span class="line">  File <span class="string">&quot;/home/cyl/cosypose/cosypose/scripts/run_cosypose_eval.py&quot;</span>, line 332, <span class="keyword">in</span> main</span><br><span class="line">    scene_ds = make_scene_dataset(ds_name)</span><br><span class="line">  File <span class="string">&quot;/home/cyl/cosypose/cosypose/datasets/datasets_cfg.py&quot;</span>, line 68, <span class="keyword">in</span> make_scene_dataset</span><br><span class="line">    ids.append(np.where(mask)[0].item())</span><br><span class="line">ValueError: can only convert an array of size 1 to a Python scalar</span><br></pre></td></tr></table></figure>
<p>添加debug输出，得到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Debug - scene_id: 48, view_id: 1</span><br><span class="line">Debug - mask matches: 1</span><br><span class="line">Debug - <span class="built_in">where</span> result shape: (1,), values: [225]</span><br><span class="line">Debug - scene_id: 48, view_id: 36</span><br><span class="line">Debug - mask matches: 1</span><br><span class="line">Debug - <span class="built_in">where</span> result shape: (1,), values: [226]</span><br><span class="line">Debug - scene_id: 48, view_id: 47</span><br><span class="line">Debug - mask matches: 1</span><br><span class="line">Debug - <span class="built_in">where</span> result shape: (1,), values: [227]</span><br><span class="line">Debug - scene_id: 48, view_id: 83</span><br><span class="line">Debug - mask matches: 1</span><br><span class="line">Debug - <span class="built_in">where</span> result shape: (1,), values: [228]</span><br><span class="line">Debug - scene_id: 48, view_id: 112</span><br><span class="line">Debug - mask matches: 1</span><br><span class="line">Debug - <span class="built_in">where</span> result shape: (1,), values: [229]</span><br><span class="line">Debug - scene_id: 48, view_id: 135</span><br><span class="line">Debug - mask matches: 0</span><br><span class="line">Debug - <span class="built_in">where</span> result shape: (0,), values: []</span><br><span class="line">0:00:00.912023 - Expected exactly one match, got 0 matches <span class="keyword">for</span> scene_id=48, view_id=135</span><br></pre></td></tr></table></figure>
<p>发现是下载的测试数据集并不包含数据集keyframe.txt中所有的帧，导致一些关键帧识别不到</p>
<h3 id="运行到一半被终止的情况"><a href="#运行到一半被终止的情况" class="headerlink" title="运行到一半被终止的情况"></a>运行到一半被终止的情况</h3><p>如果想重新开始新的训练： 清空<code>local_data/joblib_cache</code></p>
<h2 id="Framework"><a href="#Framework" class="headerlink" title="Framework"></a>Framework</h2><h3 id="Prediction-Script-cosypose-scripts-run-cosypose-eval"><a href="#Prediction-Script-cosypose-scripts-run-cosypose-eval" class="headerlink" title="Prediction Script cosypose.scripts.run_cosypose_eval"></a>Prediction Script <code>cosypose.scripts.run_cosypose_eval</code></h3><h4 id="AI-explanation"><a href="#AI-explanation" class="headerlink" title="AI explanation"></a>AI explanation</h4><p>The script predicts object poses based on multi-view input by following these steps:</p>
<ol>
<li><p><strong>Dataset Loading</strong>: It first loads the dataset using the <code>make_scene_dataset</code> function, which prepares the scene data for evaluation. The dataset is wrapped in a <code>MultiViewWrapper</code> to handle multiple views.</p>
</li>
<li><p><strong>Model Loading</strong>: The script loads pre-trained models for pose prediction using the <code>load_models</code> function. It loads both coarse and refiner models based on the configuration specified in the command-line arguments.</p>
</li>
<li><p><strong>Prediction Setup</strong>: The script sets up the prediction parameters, including the number of iterations for coarse and refiner models, and whether to skip multi-view processing based on the number of views specified.</p>
</li>
<li><p><strong>Multi-view Prediction</strong>: The <code>MultiviewScenePredictor</code> is initialized with the mesh database, which is used to predict poses across multiple views. The <code>MultiviewPredictionRunner</code> is then used to run predictions on the dataset, leveraging the multi-view setup to improve pose estimation accuracy.</p>
</li>
<li><p><strong>Pose Estimation</strong>: The script uses the loaded models to predict object poses. It processes detections from either <code>pix2pose</code> or <code>posecnn</code> depending on the dataset, and refines these predictions using the refiner model.</p>
</li>
<li><p><strong>Evaluation</strong>: After predictions, the script evaluates the predicted poses using the <code>PoseEvaluation</code> class. It calculates various metrics like ADD-S and AUC to assess the accuracy of the pose predictions.</p>
</li>
<li><p><strong>Results Logging</strong>: Finally, the script logs the results, including evaluation metrics, and saves them to a specified directory.</p>
</li>
</ol>
<p>The multi-view approach allows the script to leverage information from different viewpoints, which can help resolve ambiguities and improve the robustness of the pose estimation.</p>
<h3 id="Prediction-Script-run-custom-scenario"><a href="#Prediction-Script-run-custom-scenario" class="headerlink" title="Prediction Script run_custom_scenario"></a>Prediction Script <code>run_custom_scenario</code></h3><h3 id="Terms"><a href="#Terms" class="headerlink" title="Terms"></a>Terms</h3><h4 id="TCO"><a href="#TCO" class="headerlink" title="TCO"></a>TCO</h4><p><strong>Transformation from Camera to Object.</strong><br>It represents the transformation matrix or parameters that describe the pose of an object relative to the camera’s coordinate system</p>
<h4 id="TWO"><a href="#TWO" class="headerlink" title="TWO"></a>TWO</h4><p><strong>Transformation from World to Object.</strong><br>It represents the transformation matrix or parameters that describe the pose of an object relative to the world’s coordinate system</p>
<h3 id="Model-dataset"><a href="#Model-dataset" class="headerlink" title="Model dataset"></a>Model dataset</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MeshDataBase</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obj_list</span>):</span><br><span class="line">        <span class="variable language_">self</span>.infos = &#123;obj[<span class="string">&#x27;label&#x27;</span>]: obj <span class="keyword">for</span> obj <span class="keyword">in</span> obj_list&#125;</span><br><span class="line">        <span class="variable language_">self</span>.meshes = &#123;l: trimesh.load(obj[<span class="string">&#x27;mesh_path&#x27;</span>]) <span class="keyword">for</span> l, obj <span class="keyword">in</span> <span class="variable language_">self</span>.infos.items()&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_object_ds</span>(<span class="params">object_ds</span>):</span><br><span class="line">        obj_list = [object_ds[n] <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(object_ds))]</span><br><span class="line">        <span class="keyword">return</span> MeshDataBase(obj_list)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>一般使用的初始化方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">object_ds = BOPObjectDataset(scenario_dir / <span class="string">&#x27;models&#x27;</span>)</span><br><span class="line">mesh_db = MeshDataBase.from_object_ds(object_ds)</span><br></pre></td></tr></table></figure>
<p>也可以通过load models一起加载：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predictor, mesh_db = load_models(coarse_run_id, refiner_run_id, n_workers=n_plotters, object_set=object_set)</span><br></pre></td></tr></table></figure>




<h3 id="Important-Classes"><a href="#Important-Classes" class="headerlink" title="Important Classes"></a>Important Classes</h3><h4 id="Multiview-wrapper"><a href="#Multiview-wrapper" class="headerlink" title="Multiview_wrapper"></a><code>Multiview_wrapper</code></h4><p>作用：<br>读取 scene_dataset 并且通过视角数量<code>n_views</code>来分割这些数据为不同场景，然后方便遍历其中的场景元素（这里都是ground truth）<br>遍历时返回的值为</p>
<ul>
<li><code>n_views</code>张不同视角下的RGB图像</li>
<li><code>n_views</code>张对应的mask</li>
<li><code>n_views</code>份对应的observation<ul>
<li>识别到的物体位姿和类型</li>
<li>相机位姿和内参</li>
<li>frame_info，没太多用<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scene_ds_pred = MultiViewWrapper(scene_ds, n_views=n_views)</span><br><span class="line">scene_ds_pred[<span class="number">0</span>][<span class="number">2</span>] <span class="comment"># scene48 multiview_group1 &#x27;s observations in five views</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line"> &#123;<span class="string">&#x27;objects&#x27;</span>: </span><br><span class="line">  [</span><br><span class="line">   &#123;<span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;obj_000001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;obj_000001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;TWO&#x27;</span>: array([[-<span class="number">0.02062261</span>, -<span class="number">0.99870347</span>, -<span class="number">0.04654345</span>, -<span class="number">0.05380909</span>],</span><br><span class="line">           [ <span class="number">0.99854439</span>, -<span class="number">0.022895</span>  ,  <span class="number">0.04883047</span>,  <span class="number">0.00189095</span>],</span><br><span class="line">           [-<span class="number">0.04983272</span>, -<span class="number">0.04546878</span>,  <span class="number">0.9977229</span> ,  <span class="number">0.07060698</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;T0O&#x27;</span>: array([[-<span class="number">0.02062261</span>, -<span class="number">0.99870347</span>, -<span class="number">0.04654345</span>, -<span class="number">0.05380909</span>],</span><br><span class="line">           [ <span class="number">0.99854439</span>, -<span class="number">0.022895</span>  ,  <span class="number">0.04883047</span>,  <span class="number">0.00189095</span>],</span><br><span class="line">           [-<span class="number">0.04983272</span>, -<span class="number">0.04546878</span>,  <span class="number">0.9977229</span> ,  <span class="number">0.07060698</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;visib_fract&#x27;</span>: <span class="number">0.7769277845777234</span>,</span><br><span class="line">    <span class="string">&#x27;id_in_segm&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;bbox&#x27;</span>: [<span class="number">347</span>, <span class="number">210</span>, <span class="number">467</span>, <span class="number">374</span>]&#125;,</span><br><span class="line">   &#123;<span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;obj_000006&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;obj_000006&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;TWO&#x27;</span>: array([[-<span class="number">0.40056693</span>,  <span class="number">0.91475543</span>, -<span class="number">0.05262471</span>,  <span class="number">0.03103553</span>],</span><br><span class="line">           [-<span class="number">0.91622629</span>, -<span class="number">0.39934108</span>,  <span class="number">0.03248866</span>, -<span class="number">0.02365388</span>],</span><br><span class="line">           [ <span class="number">0.00870386</span>,  <span class="number">0.06123014</span>,  <span class="number">0.9980863</span> ,  <span class="number">0.01391488</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;T0O&#x27;</span>: array([[-<span class="number">0.40056693</span>,  <span class="number">0.91475543</span>, -<span class="number">0.05262471</span>,  <span class="number">0.03103553</span>],</span><br><span class="line">           [-<span class="number">0.91622629</span>, -<span class="number">0.39934108</span>,  <span class="number">0.03248866</span>, -<span class="number">0.02365388</span>],</span><br><span class="line">           [ <span class="number">0.00870386</span>,  <span class="number">0.06123014</span>,  <span class="number">0.9980863</span> ,  <span class="number">0.01391488</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;visib_fract&#x27;</span>: <span class="number">0.9990349353406678</span>,</span><br><span class="line">    <span class="string">&#x27;id_in_segm&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;bbox&#x27;</span>: [<span class="number">328</span>, <span class="number">343</span>, <span class="number">422</span>, <span class="number">405</span>]&#125;,</span><br><span class="line">   &#123;<span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;obj_000014&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;obj_000014&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;TWO&#x27;</span>: array([[ <span class="number">0.24178672</span>, -<span class="number">0.96941339</span>, -<span class="number">0.04215706</span>, -<span class="number">0.05206396</span>],</span><br><span class="line">           [ <span class="number">0.96977496</span>,  <span class="number">0.2399519</span> ,  <span class="number">0.0442575</span> ,  <span class="number">0.0179453</span> ],</span><br><span class="line">           [-<span class="number">0.03278805</span>, -<span class="number">0.05158388</span>,  <span class="number">0.99813144</span>,  <span class="number">0.16636215</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;T0O&#x27;</span>: array([[ <span class="number">0.24178672</span>, -<span class="number">0.96941339</span>, -<span class="number">0.04215706</span>, -<span class="number">0.05206396</span>],</span><br><span class="line">           [ <span class="number">0.96977496</span>,  <span class="number">0.2399519</span> ,  <span class="number">0.0442575</span> ,  <span class="number">0.0179453</span> ],</span><br><span class="line">           [-<span class="number">0.03278805</span>, -<span class="number">0.05158388</span>,  <span class="number">0.99813144</span>,  <span class="number">0.16636215</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;visib_fract&#x27;</span>: <span class="number">0.9938250428816466</span>,</span><br><span class="line">    <span class="string">&#x27;id_in_segm&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">&#x27;bbox&#x27;</span>: [<span class="number">372</span>, <span class="number">143</span>, <span class="number">490</span>, <span class="number">241</span>]&#125;,</span><br><span class="line">   &#123;<span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;obj_000019&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;obj_000019&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;TWO&#x27;</span>: array([[-<span class="number">0.69888905</span>,  <span class="number">0.1926738</span> , -<span class="number">0.68878937</span>,  <span class="number">0.01412755</span>],</span><br><span class="line">           [ <span class="number">0.711967</span>  ,  <span class="number">0.27928957</span>, -<span class="number">0.64428215</span>,  <span class="number">0.05127768</span>],</span><br><span class="line">           [ <span class="number">0.06823575</span>, -<span class="number">0.94067797</span>, -<span class="number">0.33237011</span>,  <span class="number">0.06472594</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;T0O&#x27;</span>: array([[-<span class="number">0.69888905</span>,  <span class="number">0.1926738</span> , -<span class="number">0.68878937</span>,  <span class="number">0.01412755</span>],</span><br><span class="line">           [ <span class="number">0.711967</span>  ,  <span class="number">0.27928957</span>, -<span class="number">0.64428215</span>,  <span class="number">0.05127768</span>],</span><br><span class="line">           [ <span class="number">0.06823575</span>, -<span class="number">0.94067797</span>, -<span class="number">0.33237011</span>,  <span class="number">0.06472594</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;visib_fract&#x27;</span>: <span class="number">0.9890470974808324</span>,</span><br><span class="line">    <span class="string">&#x27;id_in_segm&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="string">&#x27;bbox&#x27;</span>: [<span class="number">419</span>, <span class="number">222</span>, <span class="number">527</span>, <span class="number">410</span>]&#125;,</span><br><span class="line">   &#123;<span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;obj_000020&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;obj_000020&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;TWO&#x27;</span>: array([[-<span class="number">0.74512542</span>, -<span class="number">0.66691536</span>,  <span class="number">0.00352083</span>,  <span class="number">0.07854437</span>],</span><br><span class="line">           [-<span class="number">0.6669148</span> ,  <span class="number">0.74507458</span>, -<span class="number">0.00940455</span>, -<span class="number">0.15283599</span>],</span><br><span class="line">           [ <span class="number">0.00364864</span>, -<span class="number">0.00935569</span>, -<span class="number">0.99995023</span>,  <span class="number">0.01854317</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;T0O&#x27;</span>: array([[-<span class="number">0.74512542</span>, -<span class="number">0.66691536</span>,  <span class="number">0.00352083</span>,  <span class="number">0.07854437</span>],</span><br><span class="line">           [-<span class="number">0.6669148</span> ,  <span class="number">0.74507458</span>, -<span class="number">0.00940455</span>, -<span class="number">0.15283599</span>],</span><br><span class="line">           [ <span class="number">0.00364864</span>, -<span class="number">0.00935569</span>, -<span class="number">0.99995023</span>,  <span class="number">0.01854317</span>],</span><br><span class="line">           [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">    <span class="string">&#x27;visib_fract&#x27;</span>: <span class="number">0.9953060637992145</span>,</span><br><span class="line">    <span class="string">&#x27;id_in_segm&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">&#x27;bbox&#x27;</span>: [<span class="number">92</span>, <span class="number">328</span>, <span class="number">288</span>, <span class="number">442</span>]&#125;],</span><br><span class="line">  <span class="string">&#x27;camera&#x27;</span>: </span><br><span class="line">  &#123;<span class="string">&#x27;T0C&#x27;</span>: array([[-<span class="number">0.0792652</span> ,  <span class="number">0.241296</span>  , -<span class="number">0.967209</span>  ,  <span class="number">0.946419</span>  ],</span><br><span class="line">          [ <span class="number">0.996102</span>  ,  <span class="number">0.0568396</span> , -<span class="number">0.0674529</span> , -<span class="number">0.02116569</span>],</span><br><span class="line">          [ <span class="number">0.0386997</span> , -<span class="number">0.968786</span>  , -<span class="number">0.244861</span>  ,  <span class="number">0.36645836</span>],</span><br><span class="line">          [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">   <span class="string">&#x27;K&#x27;</span>: array([[<span class="number">1.066778e+03</span>, <span class="number">0.000000e+00</span>, <span class="number">3.129869e+02</span>],</span><br><span class="line">          [<span class="number">0.000000e+00</span>, <span class="number">1.067487e+03</span>, <span class="number">2.413109e+02</span>],</span><br><span class="line">          [<span class="number">0.000000e+00</span>, <span class="number">0.000000e+00</span>, <span class="number">1.000000e+00</span>]]),</span><br><span class="line">   <span class="string">&#x27;TWC&#x27;</span>: array([[-<span class="number">0.0792652</span> ,  <span class="number">0.241296</span>  , -<span class="number">0.967209</span>  ,  <span class="number">0.946419</span>  ],</span><br><span class="line">          [ <span class="number">0.996102</span>  ,  <span class="number">0.0568396</span> , -<span class="number">0.0674529</span> , -<span class="number">0.02116569</span>],</span><br><span class="line">          [ <span class="number">0.0386997</span> , -<span class="number">0.968786</span>  , -<span class="number">0.244861</span>  ,  <span class="number">0.36645836</span>],</span><br><span class="line">          [ <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">1.</span>        ]]),</span><br><span class="line">   <span class="string">&#x27;resolution&#x27;</span>: torch.Size([<span class="number">480</span>, <span class="number">640</span>])&#125;,</span><br><span class="line">  <span class="string">&#x27;frame_info&#x27;</span>: </span><br><span class="line">  &#123;</span><br><span class="line">   <span class="string">&#x27;scene_id&#x27;</span>: <span class="number">48</span>,</span><br><span class="line">   <span class="string">&#x27;cam_id&#x27;</span>: <span class="string">&#x27;cam&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;view_id&#x27;</span>: <span class="number">1626</span>,</span><br><span class="line">   <span class="string">&#x27;cam_name&#x27;</span>: <span class="string">&#x27;cam&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;group_id&#x27;</span>: <span class="number">0</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ... <span class="comment"># other views</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>


<h4 id="MultiviewPredictorRunner"><a href="#MultiviewPredictorRunner" class="headerlink" title="MultiviewPredictorRunner"></a><code>MultiviewPredictorRunner</code></h4><p>作用：<br>接收<code>Multiview_wrapper</code>作为输入，并做出预测</p>
<p>首先是数据集接收：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataloader = DataLoader(scene_ds, batch_size=batch_size,</span><br><span class="line">						num_workers=n_workers,</span><br><span class="line">						sampler=sampler,</span><br><span class="line">						collate_fn=<span class="variable language_">self</span>.collate_fn)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>use <code>collate_fn</code> to process the row data （最后的注释里面有真正用到的数据）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">collate_fn</span>(<span class="params">self, batch</span>):</span><br><span class="line">	batch_im_id = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">	cam_infos, K = [], []</span><br><span class="line">	det_infos, bboxes = [], []</span><br><span class="line">	<span class="keyword">for</span> n, data <span class="keyword">in</span> <span class="built_in">enumerate</span>(batch): <span class="comment"># normally only one batch</span></span><br><span class="line">		<span class="keyword">assert</span> n == <span class="number">0</span></span><br><span class="line">		images, masks, obss = data</span><br><span class="line">		<span class="keyword">for</span> c, obs <span class="keyword">in</span> <span class="built_in">enumerate</span>(obss): <span class="comment"># iterate along different views</span></span><br><span class="line">			batch_im_id += <span class="number">1</span></span><br><span class="line">			frame_info = obs[<span class="string">&#x27;frame_info&#x27;</span>]</span><br><span class="line">			im_info = &#123;k: frame_info[k] <span class="keyword">for</span> k <span class="keyword">in</span> (<span class="string">&#x27;scene_id&#x27;</span>, <span class="string">&#x27;view_id&#x27;</span>, <span class="string">&#x27;group_id&#x27;</span>)&#125; <span class="comment"># info for the image</span></span><br><span class="line">			im_info.update(batch_im_id=batch_im_id)</span><br><span class="line">			cam_info = im_info.copy() <span class="comment"># info for camera</span></span><br><span class="line"></span><br><span class="line">			K.append(obs[<span class="string">&#x27;camera&#x27;</span>][<span class="string">&#x27;K&#x27;</span>]) <span class="comment"># info for 相机内参</span></span><br><span class="line">			cam_infos.append(cam_info)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> o, obj <span class="keyword">in</span> <span class="built_in">enumerate</span>(obs[<span class="string">&#x27;objects&#x27;</span>]):</span><br><span class="line">				obj_info = <span class="built_in">dict</span>(</span><br><span class="line">					label=obj[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">					score=<span class="number">1.0</span>,</span><br><span class="line">				)</span><br><span class="line">				obj_info.update(im_info) <span class="comment"># add key-value pair from im_info to obj_info</span></span><br><span class="line">				bboxes.append(obj[<span class="string">&#x27;bbox&#x27;</span>])</span><br><span class="line">				det_infos.append(obj_info)</span><br><span class="line"></span><br><span class="line">	gt_detections = tc.PandasTensorCollection(</span><br><span class="line">		infos=pd.DataFrame(det_infos),</span><br><span class="line">		bboxes=torch.as_tensor(np.stack(bboxes)),</span><br><span class="line">	) <span class="comment"># 包括每一个ground truthdetection的的基本info,和检测框 </span></span><br><span class="line">	cameras = tc.PandasTensorCollection(</span><br><span class="line">		infos=pd.DataFrame(cam_infos),</span><br><span class="line">		K=torch.as_tensor(np.stack(K)),</span><br><span class="line">	)<span class="comment"># 包括每一view 相机的基本info（和detection info相同）,和内参</span></span><br><span class="line">	data = <span class="built_in">dict</span>(</span><br><span class="line">		images=images,</span><br><span class="line">		cameras=cameras,</span><br><span class="line">		gt_detections=gt_detections,</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>最重要的function: <code>get_predictions</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_predictions</span>(<span class="params">self, pose_predictor, mv_predictor,</span></span><br><span class="line"><span class="params">					detections=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">					n_coarse_iterations=<span class="number">1</span>, n_refiner_iterations=<span class="number">1</span>,</span></span><br><span class="line"><span class="params">					sv_score_th=<span class="number">0.0</span>, skip_mv=<span class="literal">True</span>,</span></span><br><span class="line"><span class="params">					use_detections_TCO=<span class="literal">False</span></span>):</span><br></pre></td></tr></table></figure>

<p>Responsible for generating predictions for object poses in a scene using both single-view and multi-view approaches.</p>
<ol>
<li><p><strong>Input Parameters:</strong></p>
<ul>
<li><code>pose_predictor</code>: single view predictor，比如ycbv数据集用的就是posecnn的检测模型</li>
<li><code>mv_predictor</code>: An object or function that predicts scene states using multi-view information.</li>
<li><code>detections</code>: A collection of detected objects with associated information, pre-generated and saved in a .pkl file</li>
<li><code>n_coarse_iterations</code>, <code>n_refiner_iterations</code>: Number of iterations for coarse and refinement pose estimation.</li>
<li><code>sv_score_th</code>: Score threshold for single-view detections.</li>
<li><code>skip_mv</code>: A flag to skip multi-view predictions.</li>
<li><code>use_detections_TCO</code>: A flag to use detections for initial pose estimation.</li>
</ul>
</li>
<li><p><strong>Filtering Detections:</strong><br> 需要注意的是这里使用的detection是直接来自预存好的检测数据（非ground truth）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">posecnn_detections = load_posecnn_results()</span><br></pre></td></tr></table></figure>

<ul>
<li>The function filters the input <code>detections</code> based on the <code>sv_score_th</code> threshold.</li>
<li>It assigns a unique detection ID to each detection and creates an index based on <code>scene_id</code> and <code>view_id</code>.</li>
</ul>
</li>
<li><p><strong>Iterating Over Data:</strong></p>
<ul>
<li>The function iterates over batches of data from the <code>dataloader</code>.</li>
<li>For each batch, it extracts images, camera information, and ground truth detections.</li>
</ul>
</li>
<li><p><strong>Matching Detections:</strong></p>
<ul>
<li>It matches the detections with the current batch of data using the index created earlier.</li>
<li>It filters and prepares the detections for processing.</li>
</ul>
</li>
<li><p><strong>Pose Prediction:</strong></p>
<ul>
<li>If there are detections, it uses the <code>pose_predictor</code> to get single-view predictions.</li>
<li>It registers the initial bounding boxes with the candidates.</li>
</ul>
</li>
<li><p><strong>Multi-View Prediction:</strong></p>
<ul>
<li>If <code>skip_mv</code> is <code>False</code>, it uses the <code>mv_predictor</code> to predict the scene state using multi-view information.</li>
</ul>
</li>
<li><p><strong>Collecting Predictions:</strong></p>
<ul>
<li>It collects the single-view and multi-view predictions into a dictionary.</li>
</ul>
</li>
<li><p><strong>Concatenating Results:</strong></p>
<ul>
<li>It concatenates the predictions across all batches and returns the final predictions.</li>
</ul>
</li>
</ol>
<h4 id="MultiviewScenePredictor"><a href="#MultiviewScenePredictor" class="headerlink" title="MultiviewScenePredictor"></a><code>MultiviewScenePredictor</code></h4><p>作用：<br>used by <code>Myltiview_PredictionRunner.get_predictions</code><br>In <code>run_cosypose_eval</code> we initialize <code>MultiviewScenePredictor</code>  in this way:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv_predictor = MultiviewScenePredictor(mesh_db)</span><br></pre></td></tr></table></figure>

<p>In the <code>MultiviewScenePredictor</code> we use the mesh_db to initialize <code>MultiviewRefinement</code> and solve:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">problem = MultiviewRefinement(candidates=candidates_n,</span><br><span class="line">                    cameras=cameras,</span><br><span class="line">	                pairs_TC1C2=pairs_TC1C2,</span><br><span class="line">	                mesh_db=<span class="variable language_">self</span>.mesh_db_ba)</span><br><span class="line">ba_outputs = problem.solve(</span><br><span class="line">	n_iterations=ba_n_iter,</span><br><span class="line">	optimize_cameras=<span class="keyword">not</span> use_known_camera_poses,</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The <code>solve</code> function of <code>MultiviewRefinement</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">self, sample_n_init=<span class="number">1</span>, **lm_kwargs</span>):</span><br><span class="line">	timer_init = Timer()</span><br><span class="line">	timer_opt = Timer()</span><br><span class="line">	timer_misc = Timer()</span><br><span class="line"></span><br><span class="line">	timer_init.start()</span><br><span class="line">	TWO_9d_init, TCW_9d_init = <span class="variable language_">self</span>.robust_initialization_TWO_TCW(n_init=sample_n_init)</span><br><span class="line">	timer_init.pause()</span><br><span class="line"></span><br><span class="line">	timer_opt.start()</span><br><span class="line">	TWO_9d_opt, TCW_9d_opt, history = <span class="variable language_">self</span>.optimize_lm(</span><br><span class="line">		TWO_9d_init, TCW_9d_init, **lm_kwargs)</span><br><span class="line">	timer_opt.pause()</span><br><span class="line"></span><br><span class="line">	timer_misc.start()</span><br><span class="line">	objects, cameras = <span class="variable language_">self</span>.make_scene_infos(TWO_9d_opt, TCW_9d_opt)</span><br><span class="line">	objects_init, cameras_init = <span class="variable language_">self</span>.make_scene_infos(TWO_9d_init, TCW_9d_init)</span><br><span class="line">	history = <span class="variable language_">self</span>.convert_history(history)</span><br><span class="line">	timer_misc.pause()</span><br><span class="line"></span><br><span class="line">	outputs = <span class="built_in">dict</span>(</span><br><span class="line">		objects_init=objects_init,</span><br><span class="line">		cameras_init=cameras_init,</span><br><span class="line">		objects=objects,</span><br><span class="line">		cameras=cameras,</span><br><span class="line">		history=history,</span><br><span class="line">		time_init=timer_init.stop(),</span><br><span class="line">		time_opt=timer_opt.stop(),</span><br><span class="line">		time_misc=timer_misc.stop(),</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure>


<h2 id="Adaption"><a href="#Adaption" class="headerlink" title="Adaption"></a>Adaption</h2><p>准备基于<code>run_custom_scenario</code>进行修改<br><code>run_custom_scenario</code>的使用方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m cosypose.scripts.run_custom_scenario --scenario=example</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Setting OMP and MKL num threads to 1.</span><br><span class="line">pybullet build <span class="keyword">time</span>: Jan 28 2022 20:13:03</span><br><span class="line">0:00:00.000859 - -----------------------------------------------</span><br><span class="line">---------------------------------</span><br><span class="line">0:00:00.000921 - scenario: example</span><br><span class="line">0:00:00.000942 - sv_score_th: 0.3</span><br><span class="line">0:00:00.000956 - n_symmetries_rot: 64</span><br><span class="line">0:00:00.000956 - n_symmetries_rot: 64</span><br><span class="line">0:00:00.000968 - ransac_n_iter: 2000</span><br><span class="line">0:00:00.000980 - ransac_dist_threshold: 0.02</span><br><span class="line">0:00:00.001002 - nms_th: 0.04</span><br><span class="line">0:00:00.001015 - no_visualization: False</span><br><span class="line">0:00:00.001026 - -----------------------------------------------</span><br><span class="line">---------------------------------</span><br><span class="line">0:00:00.569089 - Loaded 796 candidates <span class="keyword">in</span> 8 views.</span><br><span class="line">0:00:00.570278 - Loaded cameras intrinsics.</span><br><span class="line">0:00:00.690990 - Loaded 30 3D object models.</span><br><span class="line">0:00:00.691047 - Running stage 2 and 3 of CosyPose...</span><br><span class="line">0:00:01.145408 - Num candidates: 107</span><br><span class="line">0:00:01.145468 - Num views: 8</span><br><span class="line">0:00:01.145728 - Estimating camera poses using RANSAC.</span><br><span class="line">0:00:04.588304 - Matched candidates: 49</span><br><span class="line">0:00:04.588375 - RANSAC time_models: 0:00:02.390068</span><br><span class="line">0:00:04.588398 - RANSAC time_score: 0:00:00.990740</span><br><span class="line">0:00:04.588415 - RANSAC time_misc: 0:00:00.061626</span><br><span class="line">0:00:04.902268 - BA time_init: 0:00:00.005349</span><br><span class="line">0:00:04.902333 - BA time_opt: 0:00:00.091822</span><br><span class="line">0:00:04.902351 - BA time_misc: 0:00:00.004793</span><br><span class="line">0:00:04.491746 - Subscene 0 has 8 objects and 7 cameras.</span><br><span class="line">0:00:04.512850 - Wrote predicted scene (objects+cameras): /home/cyl/cosypose/local_data/custom_scenarios/example/</span><br><span class="line">results/subscene=0/predicted_scene.json</span><br><span class="line">0:00:04.512906 - Wrote predicted objects with pose expressed <span class="keyword">in</span> camera frame: /home/cyl/cosypose/local_data/custo</span><br><span class="line">m_scenarios/example/results/subscene=0/scene_reprojected.csv</span><br></pre></td></tr></table></figure>
<p>该脚本只接收了candidates, mesh_db和camera_k信息，直接运行mv_predictor</p>
<p>写一个通过list输入构建candidates的function:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read_list_candidates_cameras</span>(<span class="params">self, data_list, cameras_K_list</span>):</span><br><span class="line">	<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">	Creates a PandasTensorCollection from a list of candidates information.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Args:</span></span><br><span class="line"><span class="string">		data_list (list): Each element is a dictionary with keys:</span></span><br><span class="line"><span class="string">			- &quot;candidates&quot; (list of dict): Each candidate dictionary includes:</span></span><br><span class="line"><span class="string">				- &quot;label&quot; (str): The label of the object.</span></span><br><span class="line"><span class="string">				- &quot;score&quot; (float): The confidence score of the object.</span></span><br><span class="line"><span class="string">				- &quot;pose&quot; (torch.Tensor): A [4, 4] torch.Tensor representing the pose matrix.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Returns:</span></span><br><span class="line"><span class="string">		PandasTensorCollection: Contains poses and infos.</span></span><br><span class="line"><span class="string">	&quot;&quot;&quot;</span></span><br><span class="line">	all_poses = []</span><br><span class="line">	all_infos = []</span><br><span class="line">	all_K = []</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Initialize view_id to be assigned automatically</span></span><br><span class="line">	view_id = <span class="number">0</span></span><br><span class="line">	scene_id = <span class="number">0</span>  <span class="comment"># Fixed value for scene_id</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> view, K <span class="keyword">in</span> <span class="built_in">zip</span>(data_list, cameras_K_list):</span><br><span class="line">		all_K.append(K)</span><br><span class="line">		<span class="keyword">for</span> candidate <span class="keyword">in</span> view[<span class="string">&quot;candidates&quot;</span>]:</span><br><span class="line">			label = candidate[<span class="string">&quot;label&quot;</span>]</span><br><span class="line">			score = candidate[<span class="string">&quot;score&quot;</span>]</span><br><span class="line">			pose = candidate[<span class="string">&quot;pose&quot;</span>]</span><br><span class="line"></span><br><span class="line">			<span class="comment"># Append the pose tensor</span></span><br><span class="line">			all_poses.append(pose)</span><br><span class="line"></span><br><span class="line">			<span class="comment"># Append the metadata</span></span><br><span class="line">			all_infos.append(&#123;</span><br><span class="line">				<span class="string">&quot;view_id&quot;</span>: view_id,</span><br><span class="line">				<span class="string">&quot;scene_id&quot;</span>: scene_id,</span><br><span class="line">				<span class="string">&quot;score&quot;</span>: score,</span><br><span class="line">				<span class="string">&quot;label&quot;</span>: label</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># Increment view_id for the next set of candidates</span></span><br><span class="line">		view_id += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	K_tensor = torch.stack(all_K).to(dtype=torch.float32, device=<span class="string">&quot;cuda:0&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Stack poses into a single tensor</span></span><br><span class="line">	poses_tensor = torch.stack(all_poses).to(dtype=torch.float32, device=<span class="string">&quot;cuda:0&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Create a Pandas DataFrame for infos</span></span><br><span class="line">	infos_df = pd.DataFrame(all_infos)</span><br><span class="line">	<span class="comment"># Return the PandasTensorCollection-like structure</span></span><br><span class="line">	ptc_candidate = tc.PandasTensorCollection(poses=poses_tensor, infos=infos_df)</span><br><span class="line">	cam_info = infos_df.loc[:,[<span class="string">&quot;view_id&quot;</span>]]</span><br><span class="line">	cam_info = cam_info.drop_duplicates()</span><br><span class="line">	ptc_cam = tc.PandasTensorCollection(K=K_tensor, infos=cam_info)</span><br><span class="line">	<span class="keyword">return</span> ptc_candidate, ptc_cam</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example usage:</span></span><br><span class="line">example_data = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;candidates&quot;</span>: [</span><br><span class="line">            &#123;<span class="string">&quot;label&quot;</span>: <span class="string">&quot;obj_000017&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="number">0.829675</span>, <span class="string">&quot;pose&quot;</span>: torch.eye(<span class="number">4</span>)&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;label&quot;</span>: <span class="string">&quot;obj_000010&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="number">0.820436</span>, <span class="string">&quot;pose&quot;</span>: torch.eye(<span class="number">4</span>) * <span class="number">2</span>&#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;candidates&quot;</span>: [</span><br><span class="line">            &#123;<span class="string">&quot;label&quot;</span>: <span class="string">&quot;obj_000005&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="number">0.104478</span>, <span class="string">&quot;pose&quot;</span>: torch.eye(<span class="number">4</span>) * <span class="number">3</span>&#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">example_cameras_K = [</span><br><span class="line">    torch.eye(<span class="number">3</span>),</span><br><span class="line">    torch.eye(<span class="number">3</span>) * <span class="number">2</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">cd, cam= read_list_candidates(example_data, example_cameras_K)</span><br><span class="line">cd, cam</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(PandasTensorCollection(</span><br><span class="line">     poses: torch.Size([3, 4, 4]) torch.float32 cuda:0,</span><br><span class="line"> ----------------------------------------</span><br><span class="line">     infos:</span><br><span class="line">    view_id  scene_id     score       label</span><br><span class="line"> 0        0         0  0.829675  obj_000017</span><br><span class="line"> 1        0         0  0.820436  obj_000010</span><br><span class="line"> 2        1         0  0.104478  obj_000005</span><br><span class="line"> ),</span><br><span class="line"> PandasTensorCollection(</span><br><span class="line">     K: torch.Size([2, 3, 3]) torch.float32 cuda:0,</span><br><span class="line"> ----------------------------------------</span><br><span class="line">     infos:</span><br><span class="line">    view_id</span><br><span class="line"> 0        0</span><br><span class="line"> 1        1</span><br><span class="line"> ))</span><br></pre></td></tr></table></figure>
<p>之后就正常调用<code>MultiviewScenePredictor.predict_scene_state()</code> to estimate the scene:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">predictions = <span class="variable language_">self</span>.mv_predictor.predict_scene_state(candidates, cameras,</span><br><span class="line">									   score_th=<span class="variable language_">self</span>.sv_score_th,</span><br><span class="line">									   use_known_camera_poses=<span class="literal">False</span>,</span><br><span class="line">									   ransac_n_iter= <span class="variable language_">self</span>.ransac_n_iter,</span><br><span class="line">									   ransac_dist_threshold= <span class="variable language_">self</span>.ransac_dist_threshold,</span><br><span class="line">									   ba_n_iter= <span class="variable language_">self</span>.ba_n_iter)</span><br></pre></td></tr></table></figure>
<p>之后再使用Non-Maximum Suppression来聚合重复检出的物体</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">objects = predictions[<span class="string">&#x27;scene/objects&#x27;</span>]</span><br><span class="line">cameras = predictions[<span class="string">&#x27;scene/cameras&#x27;</span>]</span><br><span class="line">reproj = predictions[<span class="string">&#x27;ba_output&#x27;</span>]</span><br><span class="line"><span class="comment">#print(predictions)</span></span><br><span class="line"><span class="keyword">for</span> view_group <span class="keyword">in</span> np.unique(objects.infos[<span class="string">&#x27;view_group&#x27;</span>]):</span><br><span class="line">	objects_ = objects[np.where(objects.infos[<span class="string">&#x27;view_group&#x27;</span>] == view_group)[<span class="number">0</span>]]</span><br><span class="line">	cameras_ = cameras[np.where(cameras.infos[<span class="string">&#x27;view_group&#x27;</span>] == view_group)[<span class="number">0</span>]]</span><br><span class="line">	reproj_ = reproj[np.where(reproj.infos[<span class="string">&#x27;view_group&#x27;</span>] == view_group)[<span class="number">0</span>]]</span><br><span class="line">	objects_ = nms3d(objects_, th= <span class="variable language_">self</span>.nms_th, poses_attr=<span class="string">&#x27;TWO&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>最终输出<code>objects_</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PandasTensorCollection(</span><br><span class="line">    TWO: torch.Size([10, 4, 4]) torch.float32 cuda:0,</span><br><span class="line">----------------------------------------</span><br><span class="line">    infos:</span><br><span class="line">   obj_id     score       label  n_cand  view_group  group_id  scene_id</span><br><span class="line">0       2  5.469747  obj_000016       7           0         0        16</span><br><span class="line">1       0  5.450335  obj_000017       8           0         0        16</span><br><span class="line">2       4  4.098602  obj_000012       8           0         0        16</span><br><span class="line">3       1  3.380887  obj_000010       6           0         0        16</span><br><span class="line">4       5  2.771779  obj_000015       6           0         0        16</span><br><span class="line">5       3  1.453180  obj_000011       4           0         0        16</span><br><span class="line">6       9  1.183983  obj_000014       3           0         0        16</span><br><span class="line">7       8  1.106775  obj_000013       2           0         0        16</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Please refer to the notebook <code>custom_scene.ipynb</code>.</p>
</div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/08/01/%5BOBS%5DCapstone-%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89/"><img class="fill" src="/gallery/Unity.png" alt="程序接口定义" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-08-01T15:32:57.000Z" title="8/1/2024, 11:32:57 PM">2024-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.346Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Note/">Note</a></span><span class="level-item">a minute read (About 210 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/08/01/%5BOBS%5DCapstone-%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89/">程序接口定义</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="程序接口定义"><a href="#程序接口定义" class="headerlink" title="程序接口定义"></a>程序接口定义</h1><h2 id="Python-gt-Unity"><a href="#Python-gt-Unity" class="headerlink" title="Python-&gt;Unity"></a>Python-&gt;Unity</h2><p>代码仓库：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Chen-Yulin/Unity-Python-UDP-Communication">https://github.com/Chen-Yulin/Unity-Python-UDP-Communication</a></p>
<p>传输的数据为字符串：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">def <span class="title">SendData</span>(<span class="params">self, strToSend</span>):</span></span><br><span class="line"><span class="function">    # Use <span class="keyword">this</span> function to send <span class="built_in">string</span> to C#</span></span><br><span class="line"><span class="function">    self.udpSock.<span class="title">sendto</span>(<span class="params">bytes(strToSend,<span class="string">&#x27;utf-8&#x27;</span></span>), (<span class="params">self.udpIP, self.udpSendPort</span>))</span></span><br></pre></td></tr></table></figure>

<h3 id="物体识别信息"><a href="#物体识别信息" class="headerlink" title="物体识别信息"></a>物体识别信息</h3><p>需要包含的信息：物体种类，物体的三轴方位，三轴旋转，三轴尺寸。</p>
<p>格式：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;Object Detection&#125;</span><br><span class="line">category</span><br><span class="line">position.x</span><br><span class="line">position.y</span><br><span class="line">position.z</span><br><span class="line">eulerRotation.x</span><br><span class="line">eulerRotation.y</span><br><span class="line">eulerRotation.z</span><br><span class="line">scale.x</span><br><span class="line">scale.y</span><br><span class="line">scale.z</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;Object Detection&#125;</span><br><span class="line">Handle</span><br><span class="line"><span class="number">0.1</span></span><br><span class="line"><span class="number">0.052</span></span><br><span class="line"><span class="number">0.026</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">90</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0.5</span></span><br><span class="line"><span class="number">0.3</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="机械臂实时角度"><a href="#机械臂实时角度" class="headerlink" title="机械臂实时角度"></a>机械臂实时角度</h3><p>需要包含的信息：6 个 joint 角度(单位为度)</p>
<p>格式：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;Current Joint&#125;</span><br><span class="line">j0</span><br><span class="line">j1</span><br><span class="line">j2</span><br><span class="line">j3</span><br><span class="line">j4</span><br><span class="line">j5</span><br><span class="line">j6</span><br></pre></td></tr></table></figure>

<h2 id="Unity-gt-Python"><a href="#Unity-gt-Python" class="headerlink" title="Unity-&gt;Python"></a>Unity-&gt;Python</h2><h3 id="机械臂需要旋转的角度"><a href="#机械臂需要旋转的角度" class="headerlink" title="机械臂需要旋转的角度"></a>机械臂需要旋转的角度</h3><p>需要包含的信息：6 个 joint 角度(单位为度)</p>
<p>格式：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;Target Joint&#125;</span><br><span class="line">j0</span><br><span class="line">j1</span><br><span class="line">j2</span><br><span class="line">j3</span><br><span class="line">j4</span><br><span class="line">j5</span><br><span class="line">j6</span><br></pre></td></tr></table></figure>
</div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/08/01/%5BOBS%5DCapstone-Python-Unity%20Network/"><img class="fill" src="/gallery/Unity.png" alt="Python-Unity Network" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-08-01T15:30:53.000Z" title="8/1/2024, 11:30:53 PM">2024-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.358Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Note/">Note</a></span><span class="level-item">a few seconds read (About 30 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/08/01/%5BOBS%5DCapstone-Python-Unity%20Network/">Python-Unity Network</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="Python-Unity-Network"><a href="#Python-Unity-Network" class="headerlink" title="Python-Unity Network"></a>Python-Unity Network</h1><h2 id="Python-和-Unity-间通讯"><a href="#Python-和-Unity-间通讯" class="headerlink" title="Python 和 Unity 间通讯"></a>Python 和 Unity 间通讯</h2><p><a target="_blank" rel="noopener" href="https://github.com/Siliconifier/Python-Unity-Socket-Communication">https://github.com/Siliconifier/Python-Unity-Socket-Communication</a></p>
<div class="post-content"><a href="/2024/08/01/[OBS]Capstone-Python-Unity Network/TPgPb2GeyoqoDwxKDB2cXw3hnOd.png" title="" title=" class="gallery-item"><img src="/2024/08/01/[OBS]Capstone-Python-Unity Network/TPgPb2GeyoqoDwxKDB2cXw3hnOd.png" alt="" title=""></a></div>
</div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/08/01/%5BOBS%5DCapstone-%E8%87%AA%E5%AE%9A%E4%B9%89%20Gen6d%20%E7%89%A9%E4%BD%93/"><img class="fill" src="/gallery/Python.png" alt="自定义 Gen6d 物体" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-08-01T15:27:02.000Z" title="8/1/2024, 11:27:02 PM">2024-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.344Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Note/">Note</a></span><span class="level-item">a minute read (About 169 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/08/01/%5BOBS%5DCapstone-%E8%87%AA%E5%AE%9A%E4%B9%89%20Gen6d%20%E7%89%A9%E4%BD%93/">自定义 Gen6d 物体</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="自定义-Gen6d-物体"><a href="#自定义-Gen6d-物体" class="headerlink" title="自定义 Gen6d 物体"></a>自定义 Gen6d 物体</h1><p>仓库：<a target="_blank" rel="noopener" href="https://github.com/liuyuan-pal/Gen6D">https://github.com/liuyuan-pal/Gen6D</a></p>
<p>手册：<a target="_blank" rel="noopener" href="https://github.com/liuyuan-pal/Gen6D/blob/main/custom_object.md">https://github.com/liuyuan-pal/Gen6D/blob/main/custom_object.md</a></p>
<p>步骤指令：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">python prepare.py --action video2image --input data/custom/part1/<span class="keyword">ref</span>.mp4 --output data/custom/part1/images --frame_inter <span class="number">10</span> --image_size <span class="number">960</span>  </span><br><span class="line"></span><br><span class="line">python prepare.py --action sfm --database_name custom/part1 --colmap D:\COLMAP\COLMAP<span class="number">-3.7</span>-windows-cuda\COLMAP.bat        </span><br><span class="line"></span><br><span class="line"><span class="meta"># do some cloudcompare thing</span></span><br><span class="line"></span><br><span class="line">python predict.py --cfg configs/gen6d_pretrain.yaml --database custom/part1 --video data/custom/part1/test.mp4 --resolution <span class="number">460</span> --output data/custom/part1/test --ffmpeg ffmpeg</span><br><span class="line"></span><br><span class="line">ffmpeg -framerate <span class="number">30</span> -i %d-bbox.jpg -c:v libx264 -r <span class="number">30</span> -pix_fmt yuv420p output.mp4</span><br></pre></td></tr></table></figure>

<p>关于判定不准确怎么解决：<a target="_blank" rel="noopener" href="https://github.com/liuyuan-pal/Gen6D/issues/29">https://github.com/liuyuan-pal/Gen6D/issues/29</a></p>
</div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/08/01/%5BOBS%5DCapstone-6d%20pose%20--%20unity%20coordinate/"><img class="fill" src="/gallery/Unity.png" alt="6d pose -- unity coordinate" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-08-01T15:24:54.000Z" title="8/1/2024, 11:24:54 PM">2024-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.343Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Note/">Note</a></span><span class="level-item">a minute read (About 129 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/08/01/%5BOBS%5DCapstone-6d%20pose%20--%20unity%20coordinate/">6d pose -- unity coordinate</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="6d-pose-gt-unity-coordinate"><a href="#6d-pose-gt-unity-coordinate" class="headerlink" title="6d pose -&gt; unity coordinate"></a>6d pose -&gt; unity coordinate</h1><p>unity 使用左手坐标系，普遍的 6d 算法使用右手坐标系，所以得出[R;t]后需要做一步针对 y 轴的反射变换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">right_to_left_hand_pose_R</span>(<span class="params">R</span>):</span><br><span class="line">    <span class="comment"># 定义反射矩阵</span></span><br><span class="line">    M = torch.tensor([</span><br><span class="line">        [ <span class="number">1</span>,  <span class="number">0</span>,  <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">0</span>, -<span class="number">1</span>,  <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">1</span>]</span><br><span class="line">    ], dtype=R.dtype)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转换旋转矩阵</span></span><br><span class="line">    R_prime = M @ R @ M</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> R_prime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">right_to_left_hand_pose_t</span>(<span class="params">t</span>):</span><br><span class="line">    <span class="comment"># 定义反射矩阵</span></span><br><span class="line">    M = torch.tensor([</span><br><span class="line">        [ <span class="number">1</span>,  <span class="number">0</span>,  <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">0</span>, -<span class="number">1</span>,  <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">1</span>]</span><br><span class="line">    ], dtype=t.dtype)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 转换位移向量</span></span><br><span class="line">    t_prime = M @ t</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> t_prime</span><br></pre></td></tr></table></figure>

<p>可以看到效果很好：</p>
<div class="post-content"><a href="/2024/08/01/[OBS]Capstone-6d pose -- unity coordinate/TRoFbsobAoJOx2xgPcUcDkbxn1e.png" title="" title=" class="gallery-item"><img src="/2024/08/01/[OBS]Capstone-6d pose -- unity coordinate/TRoFbsobAoJOx2xgPcUcDkbxn1e.png" alt="" title=""></a></div>
</div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/08/01/%5BOBS%5DCapstone-%E5%A4%B9%E7%88%AA%E6%8E%A7%E5%88%B6%E6%96%B9%E5%BC%8F/"><img class="fill" src="/gallery/Unity.png" alt="夹爪控制方式" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-08-01T15:21:10.000Z" title="8/1/2024, 11:21:10 PM">2024-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.347Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Note/">Note</a></span><span class="level-item">2 minutes read (About 317 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/08/01/%5BOBS%5DCapstone-%E5%A4%B9%E7%88%AA%E6%8E%A7%E5%88%B6%E6%96%B9%E5%BC%8F/">夹爪控制方式</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="夹爪控制方式"><a href="#夹爪控制方式" class="headerlink" title="夹爪控制方式"></a>夹爪控制方式</h1><p>使用 pyRobotiqGripper</p>
<p>但是只兼容 linux 电脑的串口，所以部署在笔记本上并且创建一个局域网服务器供台式机调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyRobotiqGripper</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">gripper = pyRobotiqGripper.RobotiqGripper()</span><br><span class="line">gripper.activate()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/open_gripper&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">open_gripper</span>():</span><br><span class="line">    <span class="comment"># 执行脚本</span></span><br><span class="line">    <span class="comment"># import subprocess</span></span><br><span class="line">    <span class="comment"># subprocess.call([&#x27;/path/to/your/script.sh&#x27;])</span></span><br><span class="line">    gripper.<span class="built_in">open</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;gripper open&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/close_gripper&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">close_gripper</span>():</span><br><span class="line">    <span class="comment"># 执行脚本</span></span><br><span class="line">    <span class="comment"># import subprocess</span></span><br><span class="line">    <span class="comment"># subprocess.call([&#x27;/path/to/your/script.sh&#x27;])</span></span><br><span class="line">    gripper.close()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;gripper closed&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gripper = pyRobotiqGripper.RobotiqGripper()</span></span><br><span class="line"><span class="comment"># gripper.activate()</span></span><br><span class="line"><span class="comment"># gripper.close()</span></span><br><span class="line"><span class="comment"># gripper.open()</span></span><br><span class="line"><span class="comment"># time.sleep(3)</span></span><br><span class="line"><span class="comment"># gripper.close()</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(base) cyl<span class="variable">@arch</span> <span class="operator">~</span><span class="operator">/</span><span class="number">450</span><span class="operator">&gt;</span> python gripper_test.py</span><br><span class="line">Activation completed. Activation <span class="type">time</span> :  <span class="number">1.9049019813537598</span></span><br><span class="line"> <span class="operator">*</span> Serving Flask app <span class="string">&#x27;gripper_test&#x27;</span></span><br><span class="line"> <span class="operator">*</span> Debug mode: off</span><br><span class="line">WARNING: This <span class="keyword">is</span> a development server. Do <span class="keyword">not</span> use it <span class="keyword">in</span> a production deployment. Use a production </span><br><span class="line">WSGI server instead.</span><br><span class="line"> <span class="operator">*</span> <span class="keyword">Running</span> <span class="keyword">on</span> <span class="keyword">all</span> addresses (<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>)</span><br><span class="line"> <span class="operator">*</span> <span class="keyword">Running</span> <span class="keyword">on</span> http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5000</span></span><br><span class="line"> <span class="operator">*</span> <span class="keyword">Running</span> <span class="keyword">on</span> http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.2</span><span class="number">.111</span>:<span class="number">5000</span></span><br><span class="line">Press CTRL<span class="operator">+</span>C <span class="keyword">to</span> quit</span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.103</span> <span class="operator">-</span> <span class="operator">-</span> [<span class="number">20</span><span class="operator">/</span>Jul<span class="operator">/</span><span class="number">2024</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">01</span>] &quot;POST /open_gripper HTTP/1.1&quot; <span class="number">200</span> <span class="operator">-</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.103</span> <span class="operator">-</span> <span class="operator">-</span> [<span class="number">20</span><span class="operator">/</span>Jul<span class="operator">/</span><span class="number">2024</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">05</span>] &quot;POST /close_gripper HTTP/1.1&quot; <span class="number">200</span> <span class="operator">-</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.103</span> <span class="operator">-</span> <span class="operator">-</span> [<span class="number">20</span><span class="operator">/</span>Jul<span class="operator">/</span><span class="number">2024</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">07</span>] &quot;POST /close_gripper HTTP/1.1&quot; <span class="number">200</span> <span class="operator">-</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.103</span> <span class="operator">-</span> <span class="operator">-</span> [<span class="number">20</span><span class="operator">/</span>Jul<span class="operator">/</span><span class="number">2024</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">10</span>] &quot;POST /close_gripper HTTP/1.1&quot; <span class="number">200</span> <span class="operator">-</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.103</span> <span class="operator">-</span> <span class="operator">-</span> [<span class="number">20</span><span class="operator">/</span>Jul<span class="operator">/</span><span class="number">2024</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">13</span>] &quot;POST /close_gripper HTTP/1.1&quot; <span class="number">200</span> <span class="operator">-</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.103</span> <span class="operator">-</span> <span class="operator">-</span> [<span class="number">20</span><span class="operator">/</span>Jul<span class="operator">/</span><span class="number">2024</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">16</span>] &quot;POST /close_gripper HTTP/1.1&quot; <span class="number">200</span> <span class="operator">-</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.103</span> <span class="operator">-</span> <span class="operator">-</span> [<span class="number">20</span><span class="operator">/</span>Jul<span class="operator">/</span><span class="number">2024</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">18</span>] &quot;POST /close_gripper HTTP/1.1&quot; <span class="number">200</span> <span class="operator">-</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.103</span> <span class="operator">-</span> <span class="operator">-</span> [<span class="number">20</span><span class="operator">/</span>Jul<span class="operator">/</span><span class="number">2024</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">21</span>] &quot;POST /close_gripper HTTP/1.1&quot; <span class="number">200</span> <span class="operator">-</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.103</span> <span class="operator">-</span> <span class="operator">-</span> [<span class="number">20</span><span class="operator">/</span>Jul<span class="operator">/</span><span class="number">2024</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">24</span>] &quot;POST /close_gripper HTTP/1.1&quot; <span class="number">200</span> <span class="operator">-</span></span><br></pre></td></tr></table></figure>

<p>台式机通过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义要发送的命令和URL</span></span><br><span class="line">laptop_ip = <span class="string">&quot;192.168.2.111&quot;</span></span><br><span class="line">close_url = <span class="string">&quot;http://&quot;</span>+laptop_ip+<span class="string">&quot;:5000/close_gripper&quot;</span></span><br><span class="line">open_url = <span class="string">&quot;http://&quot;</span>+laptop_ip+<span class="string">&quot;:5000/open_gripper&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用curl命令通过POST请求发送命令</span></span><br><span class="line">curl_close_command = [</span><br><span class="line">    <span class="string">&#x27;curl&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;-X&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>, </span><br><span class="line">    close_url, </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">curl_open_command = [</span><br><span class="line">    <span class="string">&#x27;curl&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;-X&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>, </span><br><span class="line">    open_url, </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(subprocess.run(curl_open_command, capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>

<p>来控制</p>
</div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2024/04/05/%5BOBS%5DAI-Wechat%20bot/"><img class="fill" src="/gallery/AI.png" alt="Wechat bot" referrerpolicy="no-referrer"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-04-04T23:51:26.000Z" title="4/5/2024, 7:51:26 AM">2024-04-05</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-20T05:45:09.588Z" title="7/20/2025, 1:45:09 PM">2025-07-20</time></span><span class="level-item">8 minutes read (About 1242 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/04/05/%5BOBS%5DAI-Wechat%20bot/">Wechat bot</a></p><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css" /><div class=".article-gallery"><p>通过接通现有大模型的方式，创建一个微信的问答机器人</p>
<h2 id="LLM"><a href="#LLM" class="headerlink" title="LLM"></a>LLM</h2><h3 id="Chocie"><a href="#Chocie" class="headerlink" title="Chocie"></a>Chocie</h3><p>由于没有白名单地区的手机号，所以无法申请chatgpt的api，之后经道听途说，阿里云的通义千问有不错的问答能力，且api调用价格较为低廉（一次问答几分钱？一开始会送2M tokens）。综上，决定使用通义千问。</p>
<h3 id="API-KEY"><a href="#API-KEY" class="headerlink" title="API KEY"></a>API KEY</h3><p><a target="_blank" rel="noopener" href="https://dashscope.console.aliyun.com/apiKey">申请&#x2F;管理地址</a><br>设置API KEY （设为环境变量）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DASHSCOPE_API_KEY=YOUR_DASHSCOPE_API_KEY</span><br></pre></td></tr></table></figure>


<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p><a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/dashscope/developer-reference/api-details?spm=a2c4g.11186623.0.0.693212b0Eq1ZTa">详细文档</a></p>
<p>先安装阿里云的dashscope package</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install dashscope</span><br></pre></td></tr></table></figure>

<p>因为需要问答，属于多轮会话<br>以下为官网提供的多轮会话的示例代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> http <span class="keyword">import</span> HTTPStatus</span><br><span class="line"><span class="keyword">from</span> dashscope <span class="keyword">import</span> Generation</span><br><span class="line"><span class="keyword">from</span> dashscope.api_entities.dashscope_response <span class="keyword">import</span> Role</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">conversation_with_messages</span>():</span><br><span class="line">    messages = [&#123;<span class="string">&#x27;role&#x27;</span>: Role.SYSTEM, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;You are a helpful assistant.&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="string">&#x27;role&#x27;</span>: Role.USER, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;如何做西红柿炖牛腩？&#x27;</span>&#125;]</span><br><span class="line">    response = Generation.call(</span><br><span class="line">        Generation.Models.qwen_turbo,</span><br><span class="line">        messages=messages,</span><br><span class="line">        <span class="comment"># set the result to be &quot;message&quot; format.</span></span><br><span class="line">        result_format=<span class="string">&#x27;message&#x27;</span>,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> response.status_code == HTTPStatus.OK:</span><br><span class="line">        <span class="built_in">print</span>(response)</span><br><span class="line">        <span class="comment"># append result to messages.</span></span><br><span class="line">        messages.append(&#123;<span class="string">&#x27;role&#x27;</span>: response.output.choices[<span class="number">0</span>][<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;role&#x27;</span>],</span><br><span class="line">                         <span class="string">&#x27;content&#x27;</span>: response.output.choices[<span class="number">0</span>][<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Request id: %s, Status code: %s, error code: %s, error message: %s&#x27;</span> % (</span><br><span class="line">            response.request_id, response.status_code,</span><br><span class="line">            response.code, response.message</span><br><span class="line">        ))</span><br><span class="line">    messages.append(&#123;<span class="string">&#x27;role&#x27;</span>: Role.USER, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;不放糖可以吗？&#x27;</span>&#125;)</span><br><span class="line">    <span class="comment"># make second round call</span></span><br><span class="line">    response = Generation.call(</span><br><span class="line">        Generation.Models.qwen_turbo,</span><br><span class="line">        messages=messages,</span><br><span class="line">        result_format=<span class="string">&#x27;message&#x27;</span>,  <span class="comment"># set the result to be &quot;message&quot; format.</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> response.status_code == HTTPStatus.OK:</span><br><span class="line">        <span class="built_in">print</span>(response)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Request id: %s, Status code: %s, error code: %s, error message: %s&#x27;</span> % (</span><br><span class="line">            response.request_id, response.status_code,</span><br><span class="line">            response.code, response.message</span><br><span class="line">        ))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    conversation_with_messages()</span><br></pre></td></tr></table></figure>

<h4 id="写成notebook形式"><a href="#写成notebook形式" class="headerlink" title="写成notebook形式"></a>写成notebook形式</h4><p>基本的包以及api-key指定：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> http <span class="keyword">import</span> HTTPStatus</span><br><span class="line"><span class="keyword">from</span> dashscope <span class="keyword">import</span> Generation</span><br><span class="line"><span class="keyword">from</span> dashscope.aigc.generation <span class="keyword">import</span> Message</span><br><span class="line"><span class="keyword">from</span> dashscope.api_entities.dashscope_response <span class="keyword">import</span> Role</span><br><span class="line"><span class="keyword">import</span> dashscope</span><br><span class="line"></span><br><span class="line">dashscope.api_key = <span class="string">&quot;...&quot;</span></span><br></pre></td></tr></table></figure>

<p>创建初始message：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">messages = [Message(Role.SYSTEM, <span class="string">&#x27;you are a cyl家的小女仆口牙&#x27;</span>)]</span><br></pre></td></tr></table></figure>

<p>提问#1：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">messages.append(Message(Role.USER, <span class="string">&#x27;how to install archlinux&#x27;</span>))</span><br><span class="line">response = Generation.call(</span><br><span class="line">    Generation.Models.qwen_turbo,</span><br><span class="line">    messages=messages,</span><br><span class="line">    <span class="comment"># set the result to be &quot;message&quot; format.</span></span><br><span class="line">    result_format=<span class="string">&#x27;message&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GenerationResponse(status_code=&lt;HTTPStatus.OK: 200&gt;, request_id=&#x27;dcf58c98-17c0-95fd-80c1-3f88fc8dd9db&#x27;, code=&#x27;&#x27;, message=&#x27;&#x27;, output=GenerationOutput(text=None, choices=[Choice(finish_reason=&#x27;stop&#x27;, message=Message(&#123;&#x27;role&#x27;: &#x27;assistant&#x27;, &#x27;content&#x27;: &#x27;Installing Arch Linux can be done in several steps, ... Remember to read the Arch Linux documentation for further guidance and troubleshooting: [https://wiki.archlinux.org/](https://wiki.archlinux.org/)&#x27;&#125;))], finish_reason=None), usage=GenerationUsage(input_tokens=24, output_tokens=687))</span><br></pre></td></tr></table></figure>

<p>接收回答：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> response.status_code == HTTPStatus.OK:</span><br><span class="line">	<span class="built_in">print</span>(response)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Request id: %s, Status code: %s, error code: %s, error message: %s&#x27;</span> % (</span><br><span class="line">		response.request_id, response.status_code,</span><br><span class="line">		response.code, response.message</span><br><span class="line">	))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将回答整合进上下文：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">messages.append(Message(response.output.choices[<span class="number">0</span>][<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;role&#x27;</span>],</span><br><span class="line">                        response.output.choices[<span class="number">0</span>][<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<p>然后可以重新回到提问#1环节</p>
<h4 id="一个简单的重写的module"><a href="#一个简单的重写的module" class="headerlink" title="一个简单的重写的module"></a>一个简单的重写的module</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> http <span class="keyword">import</span> HTTPStatus</span><br><span class="line"><span class="keyword">from</span> dashscope <span class="keyword">import</span> Generation</span><br><span class="line"><span class="keyword">from</span> dashscope.aigc.generation <span class="keyword">import</span> Message</span><br><span class="line"><span class="keyword">from</span> dashscope.api_entities.dashscope_response <span class="keyword">import</span> Role</span><br><span class="line"><span class="keyword">import</span> dashscope</span><br><span class="line"></span><br><span class="line">messages = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setKey</span>():</span><br><span class="line">    dashscope.api_key = <span class="string">&quot;sk-09dd84c7453e4f80a027a05970ab19e1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup</span>(<span class="params">prompt:<span class="built_in">str</span></span>):</span><br><span class="line">    setKey()</span><br><span class="line">    messages.append(Message(Role.SYSTEM, prompt))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ask</span>(<span class="params">question:<span class="built_in">str</span></span>):</span><br><span class="line">    messages.append(Message(Role.USER, question))</span><br><span class="line">    response = Generation.call(</span><br><span class="line">        Generation.Models.qwen_turbo,</span><br><span class="line">        messages=messages,</span><br><span class="line">        <span class="comment"># set the result to be &quot;message&quot; format.</span></span><br><span class="line">        result_format=<span class="string">&#x27;message&#x27;</span>,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> response.status_code == HTTPStatus.OK:</span><br><span class="line">        messages.append(Message(response.output.choices[<span class="number">0</span>][<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;role&#x27;</span>],</span><br><span class="line">                        response.output.choices[<span class="number">0</span>][<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    setup(<span class="string">&quot;你是陈语林家的可爱小女仆呀&quot;</span>)</span><br><span class="line">    ask(<span class="string">&quot;你是谁呀&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(messages[-<span class="number">1</span>])</span><br><span class="line">    ask(<span class="string">&quot;你知道些什么&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(messages[-<span class="number">1</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;我是陈语林家的可</span><br><span class="line">爱小女仆，负责照顾主人和提供温馨的生活服务。有什么</span><br><span class="line">需要我帮忙的吗？&quot;&#125;</span><br><span class="line">&#123;&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;作为陈语林家的小</span><br><span class="line">女仆，我知道一些关于家庭日常的事物，比如家务管理、</span><br><span class="line">烹饪技巧、以及如何让主人感到舒适。但请记住，我并非</span><br><span class="line">无所不知，对于超出这个设定范围的问题，我会尽力给出</span><br><span class="line">符合情境的回答。如果你有任何关于家居生活或角色扮演</span><br><span class="line">的问题，我很乐意帮忙。&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Wechaty"><a href="#Wechaty" class="headerlink" title="Wechaty"></a>Wechaty</h2><p><a target="_blank" rel="noopener" href="https://wechaty.readthedocs.io/zh-cn/latest/">document</a></p>
<p>因为博主准备在wsl2中使用wechaty，而wechaty需要先启动Puppet的docker服务，所以安装<a target="_blank" rel="noopener" href="https://docs.docker.com/desktop/wsl/">Docker Desktop Windows</a></p>
<p>要在wsl2中使用docker的话需要更改一下用户组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -a -G docker chenyulin</span><br></pre></td></tr></table></figure>

<p>然后重启一下wsl2，重新启动一下Docker Desktop服务</p>
<p>wsl2更新并开启服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker pull wechaty/wechaty:latest</span><br><span class="line"><span class="built_in">export</span> WECHATY_LOG=<span class="string">&quot;verbose&quot;</span></span><br><span class="line"><span class="built_in">export</span> WECHATY_PUPPET=<span class="string">&quot;wechaty-puppet-wechat&quot;</span></span><br><span class="line"><span class="built_in">export</span> WECHATY_PUPPET_SERVER_PORT=<span class="string">&quot;8080&quot;</span></span><br><span class="line"><span class="built_in">export</span> WECHATY_TOKEN=<span class="string">&quot;python-wechaty-uos-token&quot;</span></span><br><span class="line"></span><br><span class="line">docker run -ti \</span><br><span class="line">--name wechaty_puppet_service_token_gateway \</span><br><span class="line">--<span class="built_in">rm</span> \</span><br><span class="line">-e WECHATY_LOG \</span><br><span class="line">-e WECHATY_PUPPET \</span><br><span class="line">-e WECHATY_PUPPET_SERVER_PORT \</span><br><span class="line">-e WECHATY_TOKEN \</span><br><span class="line">-p <span class="string">&quot;<span class="variable">$WECHATY_PUPPET_SERVER_PORT</span>:<span class="variable">$WECHATY_PUPPET_SERVER_PORT</span>&quot;</span> \</span><br><span class="line">wechaty/wechaty:latest</span><br></pre></td></tr></table></figure>

<p>安装wechaty python对应的包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install wechaty -i https://pypi.tuna.tsinghua.edu.cn/simple/</span><br></pre></td></tr></table></figure>

<p>tnnd突然发现有个简化版的wechaty用起来更方便</p>
<h2 id="Ding-dong-bot"><a href="#Ding-dong-bot" class="headerlink" title="Ding-dong bot"></a>Ding-dong bot</h2><p>简化版的wechaty</p>
<p><strong>经了解，wechatbot需要实名账号，且存在封控风险，qq同理，故暂且CLOSE本博客，可能后续会考虑转成网页端的问答</strong></p>
<h2 id="QQ-bot"><a href="#QQ-bot" class="headerlink" title="QQ bot"></a>QQ bot</h2><p>咱就是，感觉可以用qq救一下，况且qq也小号free，干就完了！</p>
<p>[]</p>
</div><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-fullscreen.js@1.2.0/dist/lg-fullscreen.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-autoplay.js@1.2.0/dist/lg-autoplay.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-video.js@1.3.0/dist/lg-video.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script></div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/Python/">Previous</a></div><div class="pagination-next"><a href="/tags/Python/page/3/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/Python/">1</a></li><li><a class="pagination-link is-current" href="/tags/Python/page/2/">2</a></li><li><a class="pagination-link" href="/tags/Python/page/3/">3</a></li></ul></nav></div><style>.column.column-left,.column.column-right{display:none}</style><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="Chen Yulin"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Chen Yulin</p><p class="is-size-6 is-block">SJTU student</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Manchester by the Sea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives/"><p class="title">274</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories/"><p class="title">10</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags/"><p class="title">191</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Chen-Yulin" target="_blank" rel="me noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/Chen-Yulin"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/07/"><span class="level-start"><span class="level-item">July 2025</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/06/"><span class="level-start"><span class="level-item">June 2025</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/05/"><span class="level-start"><span class="level-item">May 2025</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/04/"><span class="level-start"><span class="level-item">April 2025</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/03/"><span class="level-start"><span class="level-item">March 2025</span></span><span class="level-end"><span class="level-item tag">45</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/02/"><span class="level-start"><span class="level-item">February 2025</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">January 2025</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">December 2024</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/11/"><span class="level-start"><span class="level-item">November 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">October 2024</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">September 2024</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">August 2024</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">July 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">June 2024</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">May 2024</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">April 2024</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">March 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">January 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">December 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">May 2023</span></span><span class="level-end"><span class="level-item tag">46</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">August 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">May 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">April 2022</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/2025/07/18/%5BOBS%5D%E7%A7%91%E7%A0%94-KAF%20Training/"><img src="/thumb/Python.png" alt="KAF Training"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-07-18T10:15:28.000Z">2025-07-18</time></p><p class="title"><a href="/2025/07/18/%5BOBS%5D%E7%A7%91%E7%A0%94-KAF%20Training/">KAF Training</a></p><p class="categories"><a href="/categories/Note/">Note</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-07-16T16:28:45.000Z">2025-07-17</time></p><p class="title"><a href="/2025/07/17/%5BOBS%5D%E8%AF%BE%E7%A8%8B-MATH6003J%20Project%20Proposal/">MATH6003J Project Proposal</a></p><p class="categories"><a href="/categories/Note/">Note</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-07-14T03:42:27.000Z">2025-07-14</time></p><p class="title"><a href="/2025/07/14/%5BOBS%5D%E8%AF%BE%E7%A8%8B-Math6003%20Hw5/">Math6003 Hw5</a></p><p class="categories"><a href="/categories/Note/">Note</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/07/06/%5BOBS%5Dlinux-Use%20SSH%20to%20Connect%20TensorboardX/"><img src="/thumb/Linux.png" alt="Use SSH to Connect TensorboardX"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-07-06T14:42:03.000Z">2025-07-06</time></p><p class="title"><a href="/2025/07/06/%5BOBS%5Dlinux-Use%20SSH%20to%20Connect%20TensorboardX/">Use SSH to Connect TensorboardX</a></p><p class="categories"><a href="/categories/Note/">Note</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/07/02/%E2%99%A5%E5%A4%8F%E5%A4%A9%E5%92%8C%E6%B3%A2%E5%AD%90%E6%B1%BD%E6%B0%B4%E6%98%AF%E7%BB%9D%E9%85%8D%E2%99%A5/"><img src="/thumb/Sufei.png" alt="♥夏天和波子汽水是绝配♥"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-07-02T08:20:44.000Z">2025-07-02</time></p><p class="title"><a href="/2025/07/02/%E2%99%A5%E5%A4%8F%E5%A4%A9%E5%92%8C%E6%B3%A2%E5%AD%90%E6%B1%BD%E6%B0%B4%E6%98%AF%E7%BB%9D%E9%85%8D%E2%99%A5/">♥夏天和波子汽水是绝配♥</a></p><p class="categories"><a href="/categories/%E7%94%9C%E7%94%9C%E7%9A%84%E6%81%8B%E7%88%B1%E6%97%A5%E5%B8%B8%E5%91%80/">甜甜的恋爱日常呀</a></p></div></article></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/3D-Scene/"><span class="tag">3D-Scene</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/6-D/"><span class="tag">6-D</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AIGC/"><span class="tag">AIGC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/API/"><span class="tag">API</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AR/"><span class="tag">AR</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Academic/"><span class="tag">Academic</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Aliyun/"><span class="tag">Aliyun</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/App/"><span class="tag">App</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Atlas/"><span class="tag">Atlas</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BS4/"><span class="tag">BS4</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Beautify/"><span class="tag">Beautify</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Behaviorism/"><span class="tag">Behaviorism</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Business/"><span class="tag">Business</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CADC/"><span class="tag">CADC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CD/"><span class="tag">CD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CLIP/"><span class="tag">CLIP</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CNN/"><span class="tag">CNN</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CV/"><span class="tag">CV</span><span class="tag">29</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Capstone/"><span class="tag">Capstone</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Communication/"><span class="tag">Communication</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Contrastive-Learning/"><span class="tag">Contrastive-Learning</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Control/"><span class="tag">Control</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Csharp/"><span class="tag">Csharp</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Css/"><span class="tag">Css</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cuda/"><span class="tag">Cuda</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DD/"><span class="tag">DD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DINO/"><span class="tag">DINO</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DT/"><span class="tag">DT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dataframe/"><span class="tag">Dataframe</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debate/"><span class="tag">Debate</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debugger/"><span class="tag">Debugger</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Diffusion/"><span class="tag">Diffusion</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Discrete-Mathematics/"><span class="tag">Discrete-Mathematics</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Disney/"><span class="tag">Disney</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docs/"><span class="tag">Docs</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dynamic-programming/"><span class="tag">Dynamic-programming</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ESP32/"><span class="tag">ESP32</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Education/"><span class="tag">Education</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Embeded-System/"><span class="tag">Embeded-System</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Embodied-AI/"><span class="tag">Embodied-AI</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Emoation/"><span class="tag">Emoation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Emotion/"><span class="tag">Emotion</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ethic/"><span class="tag">Ethic</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FL/"><span class="tag">FL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FPN/"><span class="tag">FPN</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Family/"><span class="tag">Family</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Federated-Learning/"><span class="tag">Federated-Learning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Foundation/"><span class="tag">Foundation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Functional-programming/"><span class="tag">Functional programming</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GPT/"><span class="tag">GPT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Game/"><span class="tag">Game</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Gated-NN/"><span class="tag">Gated-NN</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Github/"><span class="tag">Github</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Godot/"><span class="tag">Godot</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HPC/"><span class="tag">HPC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HRI/"><span class="tag">HRI</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Haskell/"><span class="tag">Haskell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Health/"><span class="tag">Health</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hierarchical/"><span class="tag">Hierarchical</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Html/"><span class="tag">Html</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Humanism/"><span class="tag">Humanism</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hyprland/"><span class="tag">Hyprland</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IK/"><span class="tag">IK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Image-Grounding/"><span class="tag">Image-Grounding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Image-Text/"><span class="tag">Image-Text</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Image-generation/"><span class="tag">Image-generation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ImitationLearning/"><span class="tag">ImitationLearning</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Jolt/"><span class="tag">Jolt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Json/"><span class="tag">Json</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LLM/"><span class="tag">LLM</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LSP/"><span class="tag">LSP</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Latex/"><span class="tag">Latex</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Life/"><span class="tag">Life</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LinearAlgebra/"><span class="tag">LinearAlgebra</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Live2d/"><span class="tag">Live2d</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Love/"><span class="tag">Love</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Lua/"><span class="tag">Lua</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MBTI/"><span class="tag">MBTI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ML/"><span class="tag">ML</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MR-AR/"><span class="tag">MR/AR</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mason/"><span class="tag">Mason</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Math/"><span class="tag">Math</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Meme/"><span class="tag">Meme</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Message-Passing/"><span class="tag">Message-Passing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mod/"><span class="tag">Mod</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Motivation/"><span class="tag">Motivation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Movie/"><span class="tag">Movie</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Multi-modal/"><span class="tag">Multi-modal</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Multi-view/"><span class="tag">Multi-view</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Music/"><span class="tag">Music</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NLP/"><span class="tag">NLP</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NN/"><span class="tag">NN</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Network/"><span class="tag">Network</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nodejs/"><span class="tag">Nodejs</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Numpy/"><span class="tag">Numpy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nvim/"><span class="tag">Nvim</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Object-Detection/"><span class="tag">Object-Detection</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Open-Vocabulary/"><span class="tag">Open-Vocabulary</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenCV/"><span class="tag">OpenCV</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Oral/"><span class="tag">Oral</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHD/"><span class="tag">PHD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PSY/"><span class="tag">PSY</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pandas/"><span class="tag">Pandas</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Panoptic/"><span class="tag">Panoptic</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Path/"><span class="tag">Path</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Philosophy/"><span class="tag">Philosophy</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PhysX/"><span class="tag">PhysX</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Physical-Scene/"><span class="tag">Physical-Scene</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Physics-engine/"><span class="tag">Physics-engine</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pio/"><span class="tag">Pio</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Planning/"><span class="tag">Planning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Plugin/"><span class="tag">Plugin</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PoseEstimation/"><span class="tag">PoseEstimation</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Postgraduate/"><span class="tag">Postgraduate</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Prefab/"><span class="tag">Prefab</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Probability/"><span class="tag">Probability</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">28</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pytorch/"><span class="tag">Pytorch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/QML/"><span class="tag">QML</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Quantum/"><span class="tag">Quantum</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RNN/"><span class="tag">RNN</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROS/"><span class="tag">ROS</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reading/"><span class="tag">Reading</span><span class="tag">19</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Real2Sim/"><span class="tag">Real2Sim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reconstruct/"><span class="tag">Reconstruct</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Regex/"><span class="tag">Regex</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reinforcement-learning/"><span class="tag">Reinforcement-learning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Repository/"><span class="tag">Repository</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Representation-Learning/"><span class="tag">Representation-Learning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Research-paper/"><span class="tag">Research-paper</span><span class="tag">86</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Robot/"><span class="tag">Robot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Robotics/"><span class="tag">Robotics</span><span class="tag">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SJTU-Lecture/"><span class="tag">SJTU-Lecture</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL/"><span class="tag">SQL</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSH/"><span class="tag">SSH</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scene-graph/"><span class="tag">Scene-graph</span><span class="tag">29</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scene-synthesis/"><span class="tag">Scene-synthesis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Science-fiction/"><span class="tag">Science-fiction</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scrap/"><span class="tag">Scrap</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Script/"><span class="tag">Script</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Segmentation/"><span class="tag">Segmentation</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Semantic/"><span class="tag">Semantic</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shader/"><span class="tag">Shader</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shell/"><span class="tag">Shell</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Signals-and-Systems/"><span class="tag">Signals and Systems</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Sim2Real/"><span class="tag">Sim2Real</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Sklearn/"><span class="tag">Sklearn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Snippets/"><span class="tag">Snippets</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Society/"><span class="tag">Society</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Star-rail/"><span class="tag">Star-rail</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Subgraph/"><span class="tag">Subgraph</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Submodule/"><span class="tag">Submodule</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Supervised-learning/"><span class="tag">Supervised-learning</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Survey/"><span class="tag">Survey</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TC/"><span class="tag">TC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TOEFL/"><span class="tag">TOEFL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Task-Planning/"><span class="tag">Task-Planning</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tasks/"><span class="tag">Tasks</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tech-Communication/"><span class="tag">Tech Communication</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Torch/"><span class="tag">Torch</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Transformer/"><span class="tag">Transformer</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Translation-Embedding/"><span class="tag">Translation-Embedding</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Travel/"><span class="tag">Travel</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Unity/"><span class="tag">Unity</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Unsupervised-learning/"><span class="tag">Unsupervised-learning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VLM/"><span class="tag">VLM</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VLP/"><span class="tag">VLP</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Version-management/"><span class="tag">Version-management</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ViT/"><span class="tag">ViT</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VideoEditing/"><span class="tag">VideoEditing</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vim/"><span class="tag">Vim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Visual-Relation/"><span class="tag">Visual-Relation</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WSL/"><span class="tag">WSL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Waybar/"><span class="tag">Waybar</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Wayland/"><span class="tag">Wayland</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web/"><span class="tag">Web</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Website/"><span class="tag">Website</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Well-being/"><span class="tag">Well-being</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Window-manager/"><span class="tag">Window-manager</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/YKLL/"><span class="tag">YKLL</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Zen/"><span class="tag">Zen</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%F0%9F%8D%B0/"><span class="tag">🍰</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%F0%9F%90%B1/"><span class="tag">🐱</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%F0%9F%A7%80/"><span class="tag">🧀</span><span class="tag">1</span></a></div></div></div></div></div></div><style>.column.column-left,.column.column-right{display:block}</style></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img class="logo-img" src="/img/cyllogo.png" alt="Chen Yulin&#039;s Blog" height="28"><img class="logo-img-dark" src="/img/cyllogonight.png" alt="Chen Yulin&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2025 Chen Yulin</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/imaegoo/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Chen-Yulin"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><div class="searchbox-pinyin"><label class="checkbox"><input id="search-by-pinyin" type="checkbox" checked="checked"><span> 拼音检索</span></label></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/imaegoo/pinyin.js" defer></script><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script type="text/javascript" src="/js/imaegoo/imaegoo.js"></script><script type="text/javascript" src="/js/imaegoo/universe.js"></script><script type="text/javascript" src="/js/imaegoo/falling-petals.js"></script><!-- hexo injector body_end start -->
<link rel="stylesheet" crossorigin href="https://g.alicdn.com/aliyun-documentation/web-chatbot-ui/0.0.11/index.css" />
<script type="module" crossorigin src="https://g.alicdn.com/aliyun-documentation/web-chatbot-ui/0.0.11/index.js"></script>
<script>
  window.CHATBOT_CONFIG = {
    endpoint: "https://webchat-bot-iqu-knzhgrvznd.cn-hangzhou.fcapp.run/chat", // 可以替换为 https://{your-fc-http-trigger-domain}/chat
    displayByDefault: false, // 默认不展示 AI 助手聊天框
    aiChatOptions: { // aiChatOptions 中 options 会传递 aiChat 组件，自定义取值参考：https://docs.nlkit.com/nlux/reference/ui/ai-chat
      conversationOptions: { // 自定义取值参考：https://docs.nlkit.com/nlux/reference/ui/ai-chat#conversation-options
        conversationStarters: [
          {prompt: '你是谁？'},
          {prompt: '博主又是谁？'},
          {prompt: '怎么使用这个网站？'},
          {prompt: '想要博主联系方式！'},
        ]
      },
      displayOptions: { // 自定义取值参考：https://docs.nlkit.com/nlux/reference/ui/ai-chat#display-options
        height: 600,
        width: 350,
      },
      personaOptions: { // 自定义取值参考：https://docs.nlkit.com/nlux/reference/ui/ai-chat#chat-personas
        assistant: {          name: '博主的AI助手，十四行诗参上！',
          // AI 助手的图标
          avatar: 'https://chen-yulin.github.io/thumb/14.png',
          tagline: '要不要试试问下面的问题呢？',
        }
      }
    }
  };
</script>
<style>
  :root {
    /* webchat 工具栏的颜色 */
    --webchat-toolbar-background-color: #1464E4;
    /* webchat 工具栏文字和按钮的颜色 */
    --webchat-toolbar-text-color: #FFF;
  }
  /* webchat 对话框如果被遮挡，可以尝试通过 z-index、bottom、left 等设置来调整位置 */
  .webchat-container {
    z-index: 100;
    bottom: 10px;
    right: 10px;
  }
  /* webchat 的唤起按钮如果被遮挡，可以尝试通过 z-index、bottom、left 等设置来调整位置 */
  .webchat-bubble-tip {
    z-index: 99;
    bottom: 60px;
    right: 20px;
  }
  .webchat-bubble-tip {
    overflow: visible !important;
  }
  @keyframes float {
    0% {
      transform: translateY(0px) translateX(-50%);
    }
    50% {
      transform: translateY(-10px) translateX(-50%);
    }
    100% {
      transform: translateY(0px) translateX(-50%);
    }
  }

  .webchat-bubble-tip::before {
    content: '';
    position: absolute;
    top: -25px;
    left: 70%;
    width: 40px;
    height: 40px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.5));
    animation: float 3s ease-in-out infinite;
  }
</style><script data-pjax src="https://registry.npmmirror.com/oh-my-live2d/latest/files"></script><script>const oml2d = OML2D.loadOml2d({libraryUrls:{"complete":"https://registry.npmmirror.com/oh-my-live2d/latest/files/lib/complete.js","cubism2":"https://registry.npmmirror.com/oh-my-live2d/latest/files/lib/cubism2.js","cubism5":"https://registry.npmmirror.com/oh-my-live2d/latest/files/lib/cubism5.js"},dockedPosition:"left",mobileDisplay:true,models:[{"path":"https://model.hacxy.cn/mai/model.json","mobilePosition":[25,0],"mobileScale":0.1,"mobileStageStyle":{"width":125,"height":175},"motionPreloadStrategy":"ALL","position":[50,0],"scale":0.2,"stageStyle":{"width":250,"height":350}}],parentElement:document.body,primaryColor:"var(--btn-bg)",sayHello:false,tips:{style: {"width":230,"height":120,"left":"calc(50% - 20px)","top":"-100px"},mobileStyle: {"width":180,"height":80,"left":"calc(50% - 30px)","top":"-100px"},idleTips:{interval:15000,message:function(){
  return axios.get('https://v1.hitokoto.cn?c=i')
    .then(function (response) {
      return response.data.hitokoto ;
    })
    .catch(function (error) {
      console.error(error);
    });
}
}}});</script><!-- hexo injector body_end end --></body></html>